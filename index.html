<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <base href="https://script.google.com/macros/library/">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ò–≥—Ä–∞ —Å –§—Ä—É–∫—Ç–∞–º–∏</title>
    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            touch-action: none;
            font-family: Arial, sans-serif;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã */
        #gameContainer {
            width: 100%;
            max-width: 400px;
            height: 600px;
            background: linear-gradient(135deg, #b6e3ff 0%, #ffccd5 100%);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
            margin-top: 20px;
            border: 8px solid rgba(255, 255, 255, 0.3);
            perspective: 1000px;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(255,255,255,0.5); }
            50% { box-shadow: 0 0 20px rgba(255,255,255,0.8); }
            100% { box-shadow: 0 0 5px rgba(255,255,255,0.5); }
        }

        /* –°—á–µ—Ç—á–∏–∫ –æ—á–∫–æ–≤ */
        #score {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(87, 255, 157, 0.9);
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 15px;
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 2;
            animation: pulse 0.3s ease;
        }

        /* –¢–µ–∫—É—â–∏–π –∏ —Å–ª–µ–¥—É—é—â–∏–π —Ñ—Ä—É–∫—Ç */
        #currentFruit, #nextFruit {
            position: absolute;
            padding: 10px;
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            text-align: center;
            z-index: 1;
            pointer-events: none;
        }

        #currentFruit {
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
        }

        #currentFruit img {
            width: 50px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
            height: 50px; 
            display: block;
            margin: 0 auto;
            background: transparent; /* –£–¥–∞–ª—ë–Ω –±–µ–ª—ã–π —Ñ–æ–Ω */
        }

        #nextFruit {
            top: 10px;
            right: 10px;
            transform: scale(1); /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
            transform-origin: top right;
        }

        #nextFruit img {
            width: 50px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
            height: 50px; 
            display: block;
            margin: 0 auto;
            background: transparent; /* –£–¥–∞–ª—ë–Ω –±–µ–ª—ã–π —Ñ–æ–Ω */
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ñ—Ä—É–∫—Ç–æ–≤ */
        #collectionContainer {
            position: absolute;
            bottom: 0px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 4px;  /* –£–º–µ–Ω—å—à–∏–ª –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –¥–ª—è –±–æ–ª—å—à–µ–π –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ */
            background: rgba(53, 167, 110, 0.9);
            padding: 4px;  
            border-radius: 15px;  
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            max-width: 90%; /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —à–∏—Ä–∏–Ω—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
            overflow-x: auto; /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
            overflow-y: hidden; /* –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
            scroll-behavior: smooth; /* –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */

            /* –°–¥–µ–ª–∞–µ–º –∑–µ–ª—ë–Ω—É—é –ø–æ–ª–æ—Å–∫—É —É–∂–µ */
            height: 50px; /* –ù–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞ */
        }

        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –¥–ª—è Webkit-–±—Ä–∞—É–∑–µ—Ä–æ–≤ */
        #collectionContainer::-webkit-scrollbar {
            height: 8px;
        }

        #collectionContainer::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        #collectionContainer::-webkit-scrollbar-thumb {
            background: #35a76e;
            border-radius: 4px;
        }

        #collectionContainer::-webkit-scrollbar-thumb:hover {
            background: #2e8b57;
        }

        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –¥–ª—è Firefox */
        #collectionContainer {
            scrollbar-width: thin;
            scrollbar-color: #35a76e rgba(255, 255, 255, 0.2);
        }

        .collectionItem {
            width: 40px; /* –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
            height: 40px; /* –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #666;
            transition: transform 0.2s;
            position: relative;
            flex-shrink: 0; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–∂–∞—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        }

        .collectionItem:hover {
            transform: scale(1.1); 
        }

        .collectionItem.locked {
            background: #ddd;
            cursor: not-allowed;
        }

        /* –≠–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã */
        #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            z-index: 1000;
        }

        #gameOverScreen button {
            margin-top: 20px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: white;
            color: #333;
            cursor: pointer;
            transition: background 0.3s;
        }

        #gameOverScreen button:hover {
            background: #f0f0f0;
        }

        /* –§—Ä—É–∫—Ç—ã */
        .fruit {
            position: absolute;
            cursor: pointer;
            transition: transform 0.2s;
        }

        /* –ö–æ–Ω—Ç—Ä–æ–ª—ã */
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 10px;
            z-index: 3;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s, background 0.2s; 
        }

        .control-btn:hover {
            transform: scale(1.1);    
            background: rgba(255, 255, 255, 1);
        }

        /* –ö–æ–Ω—Ç—É—Ä */
        #boundary {
            position: absolute;
            top: 100px; 
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, 
                rgba(255,0,0,0.2) 0%,
                rgba(255,0,0,0.8) 50%,
                rgba(255,0,0,0.2) 100%
            );
            box-shadow: 0 0 10px rgba(255,0,0,0.5);
            z-index: 1;
            transition: background 0.3s, box-shadow 0.3s;
        }

        /* 3D —Ä–∞–º–∫–∞ */
        .frame-3d {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transform-style: preserve-3d;
            transform: perspective(1000px) rotateX(1deg);
            box-shadow: 
                inset 0 0 50px rgba(255,255,255,0.1),
                0 0 20px rgba(255,255,255,0.2);
        }

        /* –õ–∏–Ω–∏—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ */
        #trajectoryLine {
            display: none;
            position: absolute;
            width: 2px;
            height: 400px; 
            background: rgba(255, 255, 255, 0.5);
            border-radius: 1px;
            box-shadow: 0 0 4px rgba(255, 255, 255, 0.5);
            pointer-events: none;
            z-index: 1;
            left: 50%; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏–Ω–∏–∏ */
            transform: translateX(-50%);
        }

        /* –û–≤–µ—Ä–ª–µ–π —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∏, –ú–∞–≥–∞–∑–∏–Ω, –ö–≤–µ—Å—Ç—ã */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px; /* –î–æ–±–∞–≤–ª–µ–Ω –æ—Ç—Å—Ç—É–ø –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        }

        .overlay-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            width: 100%;
            max-width: 600px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .overlay-content h2 {
            margin-bottom: 20px;
            text-align: center;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–Ω–æ–ø–∫–∞–º –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å—Å—è –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É */
        }

        .tab-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: #eee;
            cursor: pointer;
            flex: 1;
            text-align: center;
            transition: background 0.3s, color 0.3s;
            min-width: 100px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        }

        .tab-btn.active {
            background: #35a76e;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .shop-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–Ω–æ–ø–∫–∞–º –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å—Å—è –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É */
        }

        .shop-categories .tab-btn {
            flex: 1;
            min-width: 100px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        }

        .shop-items, .settings-items, .quests-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .shop-item, .settings-item, .quest-item {
            position: relative;
            padding: 15px;
            border-radius: 10px;
            background: #f5f5f5;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .shop-item:hover, .settings-item:hover, .quest-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .buy-btn, .apply-btn {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #35a76e;
            color: white;
            transition: background 0.3s;
        }

        .buy-btn:hover, .apply-btn:hover {
            background: #2e8b57;
        }

        .apply-btn.active {
            background: #ff6b6b;
        }

        .apply-btn.active:hover {
            background: #e63946;
        }

        .preview {
            width: 100%;
            height: 100px;
            border-radius: 8px;
            margin-bottom: 10px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        .theme-preview.gradient-1 {
            background: linear-gradient(45deg, #1a002a 0%, #4a0072 50%, #6600cc 100%);
        }

        .theme-preview.gradient-2 {
            background: linear-gradient(45deg, #ff6b6b 0%, #ffd93d 50%, #6c5ce7 100%);
        }

        .theme-preview.gradient-3 {
            background: url('https://i.imgur.com/Z9bBzPv.jpg') center/cover no-repeat;
        }

        .theme-preview.gradient-4 {
            background: linear-gradient(135deg, #00bfff 0%, #1e90ff 50%, #00008b 100%);
        }

        /* –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ—Ä—É–∫—Ç–æ–≤ */
        .theme-preview.gradient-5 {
            background: linear-gradient(135deg, #ff7f50, #ff6347, #ff4500);
        }

        .theme-preview.gradient-6 {
            background: linear-gradient(45deg, #8a2be2, #4b0082, #6a5acd);
        }

        .fruit-preview.numbers {
            background: transparent; /* –£–±—Ä–∞–ª–∏ –±–µ–ª—ã–π —Ñ–æ–Ω */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .fruit-preview.balls {
            background: transparent; /* –£–±—Ä–∞–ª–∏ –±–µ–ª—ã–π —Ñ–æ–Ω */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fruit-preview.balls svg {
            width: 80px;
            height: 80px;
            background: transparent;
        }

        .fruit-preview.stars {
            background: transparent; /* –£–¥–∞–ª—ë–Ω –±–µ–ª—ã–π —Ñ–æ–Ω */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fruit-preview.clouds {
            background: transparent; /* –£–¥–∞–ª—ë–Ω –±–µ–ª—ã–π —Ñ–æ–Ω */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –ú–µ—Ç–∫–∞ "New" */
        .new-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 255, 0, 0.8); /* –ù–µ–æ–Ω–æ–≤—ã–π –∑–µ–ª—ë–Ω—ã–π */
            color: white;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 0 5px rgba(0, 255, 0, 0.7);
        }

        /* –ë–∞–ª–∞–Ω—Å */
        #balance {
            position: absolute;
            top: 60px; /* –ü–µ—Ä–µ–º–µ—â–µ–Ω–æ –Ω–∞–¥ —Ç–µ–∫—Å—Ç–æ–º –º–∞–≥–∞–∑–∏–Ω–∞ */
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 15px;
            font-weight: bold;
            z-index: 3;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            text-align: center;
            margin-bottom: 10px; /* –î–æ–±–∞–≤–ª–µ–Ω –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
            transition: background 0.3s, box-shadow 0.3s;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #333;
        }

        /* –ö–≤–µ—Å—Ç—ã */
        .quest-category {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quest-category button {
            padding: 8px 16px;
            border: none;
            border-radius: 10px;
            background: #35a76e;
            color: white;
            cursor: pointer;
            margin-bottom: 5px;
            transition: background 0.3s;
        }

        .quest-category button:hover {
            background: #2e8b57;
        }

        .quest-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .progress-bar {
            width: 70%;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            height: 10px;
            margin-left: 10px;
        }

        .progress-fill {
            height: 100%;
            background: #35a76e;
            width: 0%;
            transition: width 0.3s;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        #statsOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2500;
            padding: 20px; /* –î–æ–±–∞–≤–ª–µ–Ω –æ—Ç—Å—Ç—É–ø –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        }

        .stats-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            position: relative;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .stats-content h2 {
            margin-bottom: 20px;
        }

        .stats-content .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #333;
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        .tab-btn.category-btn {
            flex: 1;
        }

        /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤ –æ–≤–µ—Ä–ª–µ–µ */
        .overlay-content {
            overflow-y: auto;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ */
        .collectionItem.locked::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
        }

        /* –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        #newStatsBtn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s, background 0.2s; 
            margin-left: 10px; /* –î–æ–±–∞–≤–ª–µ–Ω –æ—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞ */
        }

        #newStatsBtn:hover {
            transform: scale(1.1);    
            background: rgba(255, 255, 255, 1);
        }

        /* –ù–æ–≤—ã–µ —Ç–µ–º—ã –∏ —Ñ—Ä—É–∫—Ç—ã —Å—Ç–∏–ª–∏ */
        .theme-preview.gradient-5 {
            background: linear-gradient(135deg, #ff7f50, #ff6347, #ff4500);
        }

        .theme-preview.gradient-6 {
            background: linear-gradient(45deg, #8a2be2, #4b0082, #6a5acd);
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫, –º–∞–≥–∞–∑–∏–Ω–∞, –Ω–∞–≥—Ä–∞–¥ –∏ –∫–≤–µ—Å—Ç–æ–≤ */
        .overlay-content {
            background: #ffffff;
            border-radius: 15px;
            padding: 30px;
        }

        .tab-btn {
            font-size: 16px;
            padding: 10px 0;
        }

        .shop-item, .settings-item, .quest-item {
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
        }

        .shop-item:hover, .settings-item:hover, .quest-item:hover {
            background: #f1f1f1;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .buy-btn, .apply-btn {
            font-size: 14px;
            padding: 8px 12px;
        }

        .close-btn {
            font-size: 24px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 600px) {
            #gameContainer {
                max-width: 100%;
                height: 500px;
            }

            #currentFruit, #nextFruit {
                width: 40px;
                height: 40px;
            }

            #score {
                font-size: 14px;
                padding: 8px 16px;
            }

            #balance {
                top: 50px;
                padding: 8px 16px;
                font-size: 14px;
            }

            .shop-items, .settings-items, .quests-items {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }

            .collectionItem {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="boundary"></div>
        <div class="frame-3d"></div>
        <div id="controls">
            <button id="settingsBtn" class="control-btn">‚öôÔ∏è</button>
            <button id="shopBtn" class="control-btn">üõí</button>
            <!-- –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" -->
            <button id="newStatsBtn" class="control-btn">üìà</button>
        </div>
        <div id="score">0</div>
        <div id="currentFruit"></div>
        <div id="nextFruit"></div>
        <div id="collectionContainer"></div>
        <div id="trajectoryLine"></div>
        <div id="gameOverScreen">
            <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
            <p>–í–∞—à–∏ –æ—á–∫–∏: <span id="finalScore">0</span></p>
            <button onclick="restartGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∏, –ú–∞–≥–∞–∑–∏–Ω, –ö–≤–µ—Å—Ç—ã -->
    <div id="overlay" class="overlay">
        <div class="overlay-content">
            <button class="close-btn">‚úï</button>
            <div class="tabs">
                <button class="tab-btn active" data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <button class="tab-btn" data-tab="shop">–ú–∞–≥–∞–∑–∏–Ω</button>
                <button class="tab-btn" data-tab="quests">–ö–≤–µ—Å—Ç—ã</button>
            </div>
            <div class="tab-content active" id="settings">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <!-- –î–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã -->
                <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å.</p>
                <button onclick="toggleMusic()">–í–∫–ª—é—á–∏—Ç—å/–í—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É</button>
            </div>
            <div class="tab-content" id="shop">
                <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
                <div id="balance">–ë–∞–ª–∞–Ω—Å: <span id="balanceAmount">1000</span> ü™ô</div>
                <div class="shop-categories">
                    <button class="tab-btn category-btn active" data-category="fruits">–§—Ä—É–∫—Ç—ã</button>
                    <button class="tab-btn category-btn" data-category="themes">–¢–µ–º—ã</button>
                </div>
                <div class="shop-items">
                    <!-- –≠–ª–µ–º–µ–Ω—Ç—ã –º–∞–≥–∞–∑–∏–Ω–∞ –±—É–¥—É—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>
            <div class="tab-content" id="quests">
                <h2>–ö–≤–µ—Å—Ç—ã</h2>
                <div class="quest-category">
                    <button onclick="toggleQuest('dailyQuests')">–ó–∞–¥–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</button>
                    <div class="quests-items" id="dailyQuests" style="display: none;">
                        <!-- –ó–∞–¥–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        <div class="quest-item">
                            <span>–°–æ–±—Ä–∞—Ç—å 10 —Ñ—Ä—É–∫—Ç–æ–≤</span>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 50%;"></div>
                            </div>
                        </div>
                        <div class="quest-item">
                            <span>–î–æ—Å—Ç–∏—á—å 100 –æ—á–∫–æ–≤</span>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 30%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="quest-category">
                    <button onclick="toggleQuest('achievements')">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
                    <div class="quests-items" id="achievements" style="display: none;">
                        <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        <div class="quest-item">
                            <span>–ü–µ—Ä–≤—ã–π —Ñ—Ä—É–∫—Ç</span>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 100%;"></div>
                            </div>
                        </div>
                        <div class="quest-item">
                            <span>–ú–∞—Å—Ç–µ—Ä —Ñ—Ä—É–∫—Ç–æ–≤</span>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 70%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div id="statsOverlay" class="overlay">
        <div class="stats-content">
            <button class="close-btn">‚úï</button>
            <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <p>–õ—É—á—à–∏–π —Ä–µ–π—Ç–∏–Ω–≥: <span id="bestScore">0</span> –æ—á–∫–æ–≤</p>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Matter.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ
        let bgMusic;
        let isMusicPlaying = false;

        function initAudio() {
            if (!bgMusic) {
                bgMusic = new Audio('https://opengameart.org/sites/default/files/Casual%20Game%20BGM%205.mp3');
                bgMusic.loop = true;
                bgMusic.volume = 0.3;
            }
        }

        function toggleMusic() {
            initAudio();

            if (isMusicPlaying) {
                bgMusic.pause();
                isMusicPlaying = false;
            } else {
                bgMusic.play().then(() => {
                    isMusicPlaying = true;
                }).catch(error => {
                    console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ:", error);
                    alert("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –º—É–∑—ã–∫—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤–∞—à–µ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞.");
                });
            }
        }

        // –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let balance = 1000; 
        document.getElementById('balanceAmount').textContent = balance;

        // –õ—É—á—à–∏–π —Å—á–µ—Ç
        let bestScore = localStorage.getItem('bestScore') || 0;
        document.getElementById('bestScore').textContent = bestScore;

        // –≠–ª–µ–º–µ–Ω—Ç—ã –º–∞–≥–∞–∑–∏–Ω–∞
        const shopItems = {
            themes: [
                {id: 'theme1', type: 'theme', name: '–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è —Ç–µ–º–∞', price: 100, previewClass: 'gradient-1', purchased: false, active: false, isNew: true},
                {id: 'theme2', type: 'theme', name: '–ó–∞–∫–∞—Ç–Ω–∞—è —Ç–µ–º–∞', price: 200, previewClass: 'gradient-2', purchased: false, active: false, isNew: true},
                {id: 'theme3', type: 'theme', name: '–õ–µ—Å–Ω–∞—è —Ç–µ–º–∞', price: 300, previewClass: 'gradient-3', purchased: false, active: false, isNew: false},
                {id: 'theme4', type: 'theme', name: '–û–∫–µ–∞–Ω—Å–∫–∞—è —Ç–µ–º–∞', price: 400, previewClass: 'gradient-4', purchased: false, active: false, isNew: false},
                {id: 'theme5', type: 'theme', name: '–û–≥–Ω–µ–Ω–Ω–∞—è —Ç–µ–º–∞', price: 500, previewClass: 'gradient-5', purchased: false, active: false, isNew: true},
                {id: 'theme6', type: 'theme', name: '–§–∏–æ–ª–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞', price: 600, previewClass: 'gradient-6', purchased: false, active: false, isNew: false}
            ],
            fruits: [
                {id: 'fruit1', type: 'fruit', name: '–ß–∏—Å–ª–∞', price: 150, previewClass: 'numbers', purchased: false, active: false, isNew: true},
                {id: 'fruit2', type: 'fruit', name: '–ú—è—á–∏–∫–∏', price: 300, previewClass: 'balls', purchased: false, active: false, isNew: true},
                {id: 'fruit3', type: 'fruit', name: '–ó–≤–µ–∑–¥—ã', price: 450, previewClass: 'stars', purchased: false, active: false, isNew: false},
                {id: 'fruit4', type: 'fruit', name: '–û–±–ª–∞–∫–∞', price: 600, previewClass: 'clouds', purchased: false, active: false, isNew: false},
                {id: 'fruit5', type: 'fruit', name: '–õ—å–¥–∏–Ω–∫–∏', price: 750, previewClass: 'ice', purchased: false, active: false, isNew: true},
                {id: 'fruit6', type: 'fruit', name: '–¶–≤–µ—Ç—ã', price: 900, previewClass: 'flowers', purchased: false, active: false, isNew: true},
                {id: 'fruit7', type: 'fruit', name: '–†–∞–¥—É–≥–∞', price: 1050, previewClass: 'rainbow', purchased: false, active: false, isNew: true},
                {id: 'fruit8', type: 'fruit', name: '–ü–ª–∞–º—è', price: 1200, previewClass: 'fire', purchased: false, active: false, isNew: true},
                {id: 'fruit9', type: 'fruit', name: '–õ—É–Ω–∞', price: 1350, previewClass: 'moon', purchased: false, active: false, isNew: false},
                {id: 'fruit10', type: 'fruit', name: '–°–Ω–µ–≥', price: 1500, previewClass: 'snow', purchased: false, active: false, isNew: false},
                {id: 'fruit11', type: 'fruit', name: '–ë–ª–∏–∫–∏', price: 1650, previewClass: 'glow', purchased: false, active: false, isNew: false},
                {id: 'fruit12', type: 'fruit', name: '–ú–æ—Ä–æ–∑', price: 1800, previewClass: 'frost', purchased: false, active: false, isNew: false}
            ]
        };

        // –ú–∞—Å—Å–∏–≤ —Ñ—Ä—É–∫—Ç–æ–≤ —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º –º–∞—Å—Å–∏–≤–æ–º —Ü–≤–µ—Ç–æ–≤
        const fruits = [
            { name: '–ö–ª—É–±–Ω–∏–∫–∞', colors: ['#ff6b6b', '#ff0000', '#c41e3a'], size: 40, score: 10, density: 0.001 },
            { name: '–ú–∞–ª–∏–Ω–∞', colors: ['#ff69b4', '#ff1493', '#c71585'], size: 45, score: 20, density: 0.002 },
            { name: '–ë–∞–Ω–∞–Ω', colors: ['#fff7b2', '#ffd700', '#daa520'], size: 50, score: 30, density: 0.003 },
            { name: '–¢—ã–∫–≤–∞', colors: ['#ffa500', '#ff7f00', '#ff4500'], size: 55, score: 40, density: 0.004 },
            { name: '–î—ã–Ω—è', colors: ['#fdffba', '#f0e68c', '#daa520'], size: 60, score: 50, density: 0.005 },
            { name: '–ê—Ä–±—É–∑', colors: ['#90ee90', '#32cd32', '#006400'], size: 65, score: 60, density: 0.006 },
            { name: '–ê–Ω–∞–Ω–∞—Å', colors: ['#ffd700', '#daa520', '#b8860b'], size: 70, score: 70, density: 0.007 },
            { name: '–ì—Ä—É—à–∞', colors: ['#d1e231', '#a1c349', '#6e8b3d'], size: 75, score: 80, density: 0.008 },
            { name: '–ê–ø–µ–ª—å—Å–∏–Ω', colors: ['#ffa07a', '#ff8c00', '#ff4500'], size: 50, score: 25, density: 0.0015 },
            { name: '–õ–∞–π–º', colors: ['#32cd32', '#228b22', '#006400'], size: 45, score: 20, density: 0.0025 },
            { name: '–í–∏–Ω–æ–≥—Ä–∞–¥', colors: ['#6a5acd', '#483d8b', '#2e2b5f'], size: 40, score: 15, density: 0.001 },
            { name: '–ú–∞–Ω–≥–æ', colors: ['#ffb347', '#ffcc33', '#ff6600'], size: 50, score: 30, density: 0.002 }
        ];

        // –ò–Ω–¥–µ–∫—Å—ã —Ç–µ–∫—É—â–µ–≥–æ –∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ñ—Ä—É–∫—Ç–æ–≤
        let currentFruitIndex = 0;
        let nextFruitIndex = 1;
        let score = 0;
        let canDrop = true;
        let unlockedFruits = new Set([0, 1, 2, 3, 4]); // –ù–∞—á–∞–ª—å–Ω–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ 5 –æ–±—ä–µ–∫—Ç–æ–≤

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Matter.js
        const Engine = Matter.Engine,
            Runner = Matter.Runner,
            Render = Matter.Render,
            World = Matter.World,
            Bodies = Matter.Bodies,
            Events = Matter.Events;

        const engine = Engine.create();
        const container = document.getElementById('gameContainer');
        const containerWidth = container.clientWidth;
        const containerHeight = container.clientHeight;

        const renderMatter = Render.create({
            element: container,
            engine: engine,
            options: {
                width: containerWidth,
                height: containerHeight,
                wireframes: false,
                background: 'transparent'
            }
        });

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–µ–Ω
        const walls = [
            Bodies.rectangle(containerWidth / 2, containerHeight - 30, containerWidth, 60, { isStatic: true }),
            Bodies.rectangle(-30, containerHeight / 2, 60, containerHeight, { isStatic: true }),
            Bodies.rectangle(containerWidth + 30, containerHeight / 2, 60, containerHeight, { isStatic: true })
        ];

        World.add(engine.world, walls);

        // –ó–∞–ø—É—Å–∫ Runner –≤–º–µ—Å—Ç–æ Engine.run –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
        const runner = Runner.create();
        Runner.run(runner, engine);

        Render.run(renderMatter);

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ—Ä—É–∫—Ç–∞
        function createFruit(x, y, fruitIndex) {
            if (fruitIndex === undefined || !fruits[fruitIndex]) {
                console.error('–ù–µ–≤–µ—Ä–Ω—ã–π fruitIndex:', fruitIndex);
                return null;
            }
            
            const fruit = fruits[fruitIndex];
            if (!fruit) {
                console.error('–§—Ä—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è index:', fruitIndex);
                return null;
            }
            
            const circle = Bodies.circle(x, y, (fruit.size / 2), {
                restitution: 0.5,
                friction: 0.8,
                density: fruit.density,
                fruitIndex: fruitIndex,
                render: {
                    sprite: {
                        texture: `data:image/svg+xml,${encodeURIComponent(createFruitSVG(fruit, fruitIndex))}`,
                        xScale: 1,
                        yScale: 1
                    }
                }
            });
            return circle;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ —Ñ—Ä—É–∫—Ç–∞
        function getRandomFruitIndex() {
            return Math.floor(Math.random() * fruits.length);
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è SVG –¥–ª—è —Ñ—Ä—É–∫—Ç–∞
        function createFruitSVG(fruit, fruitIndex) {
            if (!fruit || typeof fruitIndex === 'undefined') {
                console.error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ—Ä—É–∫—Ç –∏–ª–∏ –∏–Ω–¥–µ–∫—Å —Ñ—Ä—É–∫—Ç–∞', { fruit, fruitIndex });
                return '';
            }

            try {
                const activeFruitSet = shopItems.fruits.find(f => f.active);
                let svgContent = '';

                if (activeFruitSet && activeFruitSet.id === 'fruit1') {
                    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —á–∏—Å–µ–ª
                    svgContent = `
                        <svg width="${fruit.size}" height="${fruit.size}" viewBox="0 0 ${fruit.size} ${fruit.size}" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="${fruit.size / 2}" cy="${fruit.size / 2}" r="${fruit.size / 2 - 2}" 
                                    fill="transparent" 
                                    stroke="#e0e0e0" 
                                    stroke-width="2"/>
                            <text x="50%" y="50%" 
                                  text-anchor="middle" 
                                  dominant-baseline="middle"
                                  font-family="Arial, sans-serif"
                                  font-size="${fruit.size / 2}px" 
                                  font-weight="bold" 
                                  fill="#333">
                                ${fruitIndex + 1}
                            </text>
                        </svg>`;
                } else if (activeFruitSet && activeFruitSet.id === 'fruit2') {
                    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –º—è—á–∏–∫–æ–≤ –±–µ–∑ –±–µ–ª–æ–≥–æ —Ñ–æ–Ω–∞
                    svgContent = `
                        <svg width="${fruit.size}" height="${fruit.size}" viewBox="0 0 ${fruit.size} ${fruit.size}" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="${fruit.size / 2}" cy="${fruit.size / 2}" r="${fruit.size / 2 - 2}" 
                                   fill="hsl(${(fruitIndex * 50) % 360}, 70%, 60%)"
                                   stroke="hsl(${(fruitIndex * 50) % 360}, 70%, 50%)"
                                   stroke-width="2"/>
                            <circle cx="${fruit.size * 0.3}" cy="${fruit.size * 0.3}" 
                                   r="${fruit.size * 0.1}" fill="rgba(255,255,255,0.7)"/>
                        </svg>`;
                } else if (activeFruitSet && activeFruitSet.id === 'fruit3') {
                    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∑–≤–µ–∑–¥
                    svgContent = `
                        <svg width="${fruit.size}" height="${fruit.size}" viewBox="0 0 ${fruit.size} ${fruit.size}" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <radialGradient id="grad${fruitIndex}" cx="30%" cy="30%" r="70%" fx="30%" fy="30%">
                                    <stop offset="0%" style="stop-color:#ffff00;stop-opacity:1" />
                                    <stop offset="50%" style="stop-color:#ffcc00;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#ff9900;stop-opacity:1" />
                                </radialGradient>
                            </defs>
                            <polygon points="${fruit.size / 2},5 ${fruit.size * 0.61},35 ${fruit.size},35 ${fruit.size * 0.68},55 ${fruit.size * 0.81},85 ${fruit.size / 2},65 ${fruit.size * 0.19},85 ${fruit.size * 0.32},55 ${0},35 ${fruit.size * 0.39},35" fill="url(#grad${fruitIndex})"/>
                        </svg>`;
                } else if (activeFruitSet && activeFruitSet.id === 'fruit4') {
                    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ–±–ª–∞–∫–æ–≤
                    svgContent = `
                        <svg width="${fruit.size}" height="${fruit.size}" viewBox="0 0 ${fruit.size} ${fruit.size}" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="${fruit.size / 2}" cy="${fruit.size / 2 - 5}" r="${fruit.size / 4}" fill="#ffffff" />
                            <circle cx="${fruit.size / 2 + 15}" cy="${fruit.size / 2}" r="${fruit.size / 4}" fill="#ffffff" />
                            <circle cx="${fruit.size / 2 - 15}" cy="${fruit.size / 2}" r="${fruit.size / 4}" fill="#ffffff" />
                            <circle cx="${fruit.size / 2}" cy="${fruit.size / 2 + 10}" r="${fruit.size / 5}" fill="#ffffff" />
                        </svg>`;
                } else {
                    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
                    const [color1, color2, color3] = fruit.colors;
                    if (shopItems.themes.find(t => t.active && t.id === 'theme3')) {
                        // –õ–µ—Å–Ω–∞—è —Ç–µ–º–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
                        svgContent = `
                            <svg width="${fruit.size}" height="${fruit.size}" viewBox="0 0 ${fruit.size} ${fruit.size}" xmlns="http://www.w3.org/2000/svg">
                                <image href="https://i.imgur.com/Z9bBzPv.jpg" width="${fruit.size}" height="${fruit.size}" />
                                <circle cx="${fruit.size / 2}" cy="${fruit.size / 2}" r="${fruit.size / 2 - 2}" fill="rgba(0,0,0,0.2)"/>
                            </svg>`;
                    } else {
                        // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
                        svgContent = `
                            <svg width="${fruit.size}" height="${fruit.size}" viewBox="0 0 ${fruit.size} ${fruit.size}" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <radialGradient id="grad${fruitIndex}" cx="30%" cy="30%" r="70%" fx="30%" fy="30%">
                                        <stop offset="0%" style="stop-color:${color1};stop-opacity:1" />
                                        <stop offset="50%" style="stop-color:${color2};stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:${color3};stop-opacity:1" />
                                    </radialGradient>
                                </defs>
                                <circle cx="${fruit.size / 2}" cy="${fruit.size / 2}" r="${fruit.size / 2 - 2}" fill="url(#grad${fruitIndex})"/>
                                <circle cx="${fruit.size * 0.3}" cy="${fruit.size * 0.3}" r="${fruit.size * 0.1}" fill="rgba(255,255,255,0.7)"/>
                            </svg>`;
                    }
                }

                return svgContent;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤ createFruitSVG:', error);
                return ''; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –∏–ª–∏ –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞–≥–∞–∑–∏–Ω–∞
        function renderShopItems() {
            const categoryButton = document.querySelector('#shop .shop-categories .tab-btn.active');
            const category = categoryButton ? categoryButton.dataset.category : 'themes';
            const shopItemsContainer = document.querySelector('#shop .shop-items');
            shopItemsContainer.innerHTML = '';
            
            const currentCategoryItems = shopItems[category] || shopItems.themes;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            if (category !== 'themes' && category !== 'fruits') {
                console.error('–ù–µ–≤–µ—Ä–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è:', category);
                return;
            }

            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–æ 12
            currentCategoryItems.slice(0, 12).forEach(item => {
                shopItemsContainer.innerHTML += shopItemTemplate(item);
            });

            // –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–§—Ä—É–∫—Ç—ã" –∏ —Ç–æ–≤–∞—Ä—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
            if (category === 'fruits' && currentCategoryItems.length === 0) {
                shopItemsContainer.innerHTML = '<p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ—Ä—É–∫—Ç–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏.</p>';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
        function initShop() {
            renderShopItems();

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –º–∞–≥–∞–∑–∏–Ω–∞
            document.querySelectorAll('#shop .shop-categories .tab-btn').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('#shop .shop-categories .tab-btn').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    renderShopItems();
                });
            });
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        function applyActiveItems() {
            const activeTheme = shopItems.themes.find(t => t.active);
            const activeFruitSet = shopItems.fruits.find(f => f.active);
            
            if (activeTheme) {
                if (activeTheme.id === 'theme1') {
                    document.getElementById('gameContainer').style.background = 
                        'linear-gradient(45deg, #1a002a 0%, #4a0072 50%, #6600cc 100%)';
                } else if (activeTheme.id === 'theme2') {
                    document.getElementById('gameContainer').style.background = 
                        'linear-gradient(45deg, #ff6b6b 0%, #ffd93d 50%, #6c5ce7 100%)';
                } else if (activeTheme.id === 'theme3') {
                    document.getElementById('gameContainer').style.background = 
                        'url("https://i.imgur.com/Z9bBzPv.jpg") center/cover no-repeat';
                } else if (activeTheme.id === 'theme4') {
                    document.getElementById('gameContainer').style.background = 
                        'linear-gradient(135deg, #00bfff 0%, #1e90ff 50%, #00008b 100%)';
                } else if (activeTheme.id === 'theme5') {
                    document.getElementById('gameContainer').style.background = 
                        'linear-gradient(135deg, #ff7f50, #ff6347, #ff4500)';
                } else if (activeTheme.id === 'theme6') {
                    document.getElementById('gameContainer').style.background = 
                        'linear-gradient(45deg, #8a2be2, #4b0082, #6a5acd)';
                }
            } else {
                document.getElementById('gameContainer').style.background = 
                    'linear-gradient(135deg, #b6e3ff 0%, #ffccd5 100%)';
            }
            
            if (activeFruitSet) {
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ñ—Ä—É–∫—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∏–¥–∞ —Ñ—Ä—É–∫—Ç–æ–≤ –≤ –∏–≥—Ä–µ
                // –ù–∞–ø—Ä–∏–º–µ—Ä, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞, —Ü–≤–µ—Ç–∞ –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
                // –í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã –±—É–¥–µ–º –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å
                console.log(`–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω —Ñ—Ä—É–∫—Ç: ${activeFruitSet.name}`);
            } else {
                console.log('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ñ—Ä—É–∫—Ç–∞');
            }
            
            updateNextFruit();
            
            const bodies = Matter.Composite.allBodies(engine.world);
            bodies.forEach(body => {
                if (body.fruitIndex !== undefined) {
                    const newTexture = `data:image/svg+xml,${encodeURIComponent(createFruitSVG(fruits[body.fruitIndex], body.fruitIndex))}`;
                    if (body.render && body.render.sprite) {
                        body.render.sprite.texture = newTexture;
                    }
                }
            });
        }

        // –®–∞–±–ª–æ–Ω –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ –º–∞–≥–∞–∑–∏–Ω–∞
        const shopItemTemplate = (item) => `
            <div class="shop-item ${item.type}-item" data-id="${item.id}">
                <div class="preview ${item.type}-preview ${item.previewClass}">
                    ${item.isNew ? `<div class="new-badge">New</div>` : ''}
                </div>
                <span>${item.name}</span>
                ${item.purchased ? 
                    `<button class="apply-btn ${item.active ? 'active' : ''}">${item.active ? '–û—Ç–∫–ª—é—á–∏—Ç—å' : '–ü—Ä–∏–º–µ–Ω–∏—Ç—å'}</button>` : 
                    `<button class="buy-btn">–ö—É–ø–∏—Ç—å –∑–∞ ${item.price} ü™ô</button>`}
            </div>
        `;

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –ø–æ –º–∞–≥–∞–∑–∏–Ω–∞–º
        document.addEventListener('click', (e) => {
            const button = e.target;
            if (!button.matches('.buy-btn, .apply-btn')) return;

            const itemContainer = button.closest('.shop-item');
            if (!itemContainer) return;

            const itemId = itemContainer.dataset.id;
            const categoryButton = document.querySelector('#shop .shop-categories .tab-btn.active');
            const category = categoryButton ? categoryButton.dataset.category : 'themes';
            const item = shopItems[category].find(item => item.id === itemId);

            if (button.classList.contains('buy-btn')) {
                buyItem(item);
            } else if (button.classList.contains('apply-btn')) {
                toggleItem(item);
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–∞
        function buyItem(item) {
            if (!item) return;
            
            if (balance >= item.price) {
                balance -= item.price;
                document.getElementById('balanceAmount').textContent = balance;
                item.purchased = true;
                renderShopItems();
                alert(`–í—ã –∫—É–ø–∏–ª–∏ ${item.name}!`);
            } else {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —ç—Ç–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞.');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
        function toggleItem(item) {
            if (!item) return;
            
            const items = shopItems[item.type === 'theme' ? 'themes' : 'fruits'];
            items.forEach(i => {
                if (i.id !== item.id) {
                    i.active = false;
                }
            });
            item.active = !item.active;
            
            applyActiveItems();
            renderShopItems();
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏ —Ç–µ–∫—É—â–µ–≥–æ —Ñ—Ä—É–∫—Ç–æ–≤
        function updateNextFruit() {
            try {
                if (typeof nextFruitIndex === 'undefined' || !fruits[nextFruitIndex]) {
                    console.error('–ù–µ–≤–µ—Ä–Ω—ã–π nextFruitIndex:', nextFruitIndex);
                    return;
                }

                const nextFruitHTML = `
                    <img src="data:image/svg+xml,${encodeURIComponent(createFruitSVG(fruits[nextFruitIndex], nextFruitIndex))}" alt="${fruits[nextFruitIndex].name}">
                `;
                const nextFruitElement = document.getElementById('nextFruit');
                if (nextFruitElement) {
                    nextFruitElement.innerHTML = nextFruitHTML;
                }

                if (typeof currentFruitIndex === 'undefined' || !fruits[currentFruitIndex]) {
                    console.error('–ù–µ–≤–µ—Ä–Ω—ã–π currentFruitIndex:', currentFruitIndex);
                    return;
                }

                const currentFruitHTML = `
                    <img src="data:image/svg+xml,${encodeURIComponent(createFruitSVG(fruits[currentFruitIndex], currentFruitIndex))}" alt="${fruits[currentFruitIndex].name}">
                `;
                const currentFruitElement = document.getElementById('currentFruit');
                if (currentFruitElement) {
                    currentFruitElement.innerHTML = currentFruitHTML;
                    currentFruitElement.style.animation = 'glow 2s infinite';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤ updateNextFruit:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞
        function updateScore(points) {
            score += points;
            const scoreElement = document.getElementById('score');
            scoreElement.style.animation = 'none';
            scoreElement.offsetHeight; // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
            scoreElement.style.animation = 'pulse 0.3s ease';
            scoreElement.innerHTML = score;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ —Å—á–µ—Ç–∞
            if (score > bestScore) {
                bestScore = score;
                localStorage.setItem('bestScore', bestScore);
                document.getElementById('bestScore').textContent = bestScore;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        function updateCollection() {
            const container = document.getElementById('collectionContainer');
            container.innerHTML = '';
            
            fruits.forEach((fruit, index) => {
                const item = document.createElement('div');
                item.className = `collectionItem ${unlockedFruits.has(index) ? '' : 'locked'}`;
                item.innerHTML = unlockedFruits.has(index) ? 
                    `<img src="data:image/svg+xml,${encodeURIComponent(createFruitSVG(fruit, index))}" alt="${fruit.name}" style="width: 100%; height: 100%; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));">` :
                    '?';
                container.appendChild(item);
            });
        }

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        let isDragging = false;
        let currentX = containerWidth / 2;
        let shopOpen = false;
        let isOverlayOpen = false;

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –º—ã—à–∏ –∏ –∫–∞—Å–∞–Ω–∏—è
        container.addEventListener('mousedown', startDrag);
        container.addEventListener('mousemove', drag);
        container.addEventListener('mouseup', endDrag);
        container.addEventListener('touchstart', e => {
            e.preventDefault();
            startDrag(e.touches[0]);
        });
        container.addEventListener('touchmove', e => {
            e.preventDefault();
            drag(e.touches[0]);
        });
        container.addEventListener('touchend', endDrag);

        // –§—É–Ω–∫—Ü–∏—è –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        function startDrag(e) {
            if (!canDrop || shopOpen || isOverlayOpen) return;
            isDragging = true;
            const containerRect = container.getBoundingClientRect();
            currentX = Math.min(Math.max(e.clientX - containerRect.left, fruits[currentFruitIndex].size / 2), containerWidth - fruits[currentFruitIndex].size / 2);
            updateTrajectoryLine(currentX);
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        function drag(e) {
            if (!isDragging || !canDrop || shopOpen || isOverlayOpen) return;
            const containerRect = container.getBoundingClientRect();
            currentX = Math.min(Math.max(e.clientX - containerRect.left, fruits[currentFruitIndex].size / 2), containerWidth - fruits[currentFruitIndex].size / 2);
            updateTrajectoryLine(currentX);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        function endDrag() {
            if (!isDragging || !canDrop || shopOpen || isOverlayOpen) return;
            isDragging = false;
            document.getElementById('trajectoryLine').style.display = 'none';

            if (canDrop) {
                const newFruit = createFruit(currentX, 150, currentFruitIndex);
                if (newFruit) {
                    World.add(engine.world, newFruit);
                }
                
                canDrop = false;
                setTimeout(() => {
                    canDrop = true;
                    currentFruitIndex = nextFruitIndex;
                    nextFruitIndex = getRandomFruitIndex();
                    updateNextFruit();
                }, 500);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
        function checkCollision(event) {
            const pairs = event.pairs;
            
            pairs.forEach(pair => {
                const bodyA = pair.bodyA;
                const bodyB = pair.bodyB;
                
                if (bodyA.fruitIndex !== undefined && bodyB.fruitIndex !== undefined) {
                    if (bodyA.fruitIndex === bodyB.fruitIndex) {
                        const newIndex = bodyA.fruitIndex + 1;
                        if (newIndex < fruits.length) {
                            const midX = (bodyA.position.x + bodyB.position.x) / 2;
                            const midY = (bodyA.position.y + bodyB.position.y) / 2;
                            
                            World.remove(engine.world, [bodyA, bodyB]);
                            const newFruit = createFruit(midX, midY, newIndex);
                            if (newFruit) {
                                World.add(engine.world, newFruit);
                            }
                            
                            unlockedFruits.add(newIndex);
                            updateCollection();
                            updateScore(fruits[newIndex].score);
                        }
                    }
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
        function checkGameOver() {
            const bodies = Matter.Composite.allBodies(engine.world);
            const boundary = document.getElementById('boundary');
            
            for (let body of bodies) {
                if (body.position.y < 100 && !body.isStatic) {
                    boundary.style.background = 'rgba(255,0,0,0.8)';
                    boundary.style.boxShadow = '0 0 20px red';
                    
                    setTimeout(() => {
                        boundary.style.background = '';
                        boundary.style.boxShadow = '';
                    }, 300);
                    
                    gameOver();
                    break;
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
        function gameOver() {
            const gameOverScreen = document.getElementById('gameOverScreen');
            document.getElementById('finalScore').textContent = score;
            gameOverScreen.style.display = 'flex';
            canDrop = false;
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã
        function restartGame() {
            const bodies = Matter.Composite.allBodies(engine.world);
            bodies.forEach(body => {
                if (!body.isStatic) {
                    World.remove(engine.world, body);
                }
            });
            
            score = 0;
            canDrop = true;
            currentFruitIndex = getRandomFruitIndex();
            nextFruitIndex = getRandomFruitIndex();
            unlockedFruits = new Set([0, 1, 2, 3, 4]); // –°–±—Ä–æ—Å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—Ä—É–∫—Ç–æ–≤
            
            updateScore(0);
            updateNextFruit();
            updateCollection();
            document.getElementById('gameOverScreen').style.display = 'none';
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–≤–µ—Ä–ª–µ—è –ù–∞—Å—Ç—Ä–æ–µ–∫
        document.getElementById('settingsBtn').addEventListener('click', () => {
            document.getElementById('overlay').style.display = 'flex';
            shopOpen = true;
            isOverlayOpen = true;
            canDrop = false;
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
        document.getElementById('shopBtn').addEventListener('click', () => {
            document.getElementById('overlay').style.display = 'flex';
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ú–∞–≥–∞–∑–∏–Ω"
            document.querySelectorAll('.overlay-content .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const shopTab = document.querySelector('.overlay-content .tab-btn[data-tab="shop"]');
            if (shopTab) {
                shopTab.classList.add('active');
            }

            document.querySelectorAll('.overlay-content .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            const shopContent = document.getElementById('shop');
            if (shopContent) {
                shopContent.classList.add('active');
            }

            shopOpen = true;
            isOverlayOpen = true;
            canDrop = false;
            renderShopItems();
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–æ–≤–æ–π –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        document.getElementById('newStatsBtn').addEventListener('click', () => {
            document.getElementById('statsOverlay').style.display = 'flex';
            shopOpen = true;
            isOverlayOpen = true;
            canDrop = false;
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–≤–µ—Ä–ª–µ—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        document.querySelectorAll('.overlay .close-btn').forEach(button => {
            button.addEventListener('click', () => {
                document.getElementById('overlay').style.display = 'none';
                document.getElementById('statsOverlay').style.display = 'none';
                shopOpen = false;
                isOverlayOpen = false;
                canDrop = true;
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫ –≤ –æ–≤–µ—Ä–ª–µ–µ
        document.querySelectorAll('.overlay-content .tab-btn').forEach(button => {
            button.addEventListener('click', () => {
                // –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ active —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
                document.querySelectorAll('.overlay-content .tab-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                // –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ active —É –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–æ–≤
                document.querySelectorAll('.overlay-content .tab-content').forEach(content => content.classList.remove('active'));
                const activeTab = button.dataset.tab;
                const activeContent = document.getElementById(activeTab);
                if (activeContent) {
                    activeContent.classList.add('active');
                }

                // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–∞–≥–∞–∑–∏–Ω, –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –±–∞–ª–∞–Ω—Å
                if (activeTab === 'shop') {
                    const balanceDiv = document.getElementById('balance');
                    if (balanceDiv) {
                        balanceDiv.style.display = 'block';
                    }
                    renderShopItems();
                } else {
                    const balanceDiv = document.getElementById('balance');
                    if (balanceDiv) {
                        balanceDiv.style.display = 'none';
                    }
                }
            });
        });

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ –Ω–æ–≤–æ–π –∫–Ω–æ–ø–∫–∏
        function openStats() {
            document.getElementById('statsOverlay').style.display = 'flex';
            shopOpen = true;
            isOverlayOpen = true;
            canDrop = false;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–∏–Ω–∏–∏ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
        function updateTrajectoryLine(x) {
            const line = document.getElementById('trajectoryLine');
            const currentFruitElement = document.getElementById('currentFruit');
            
            if (!line || !currentFruitElement) return;
            
            line.style.display = 'block';
            // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏–Ω–∏–∏ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ left: 50% –∏ transform: translateX(-50%)
            // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ª–∏–Ω–∏—è –≤—Å–µ–≥–¥–∞ –±—ã–ª–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–≤–µ—Å—Ç–æ–≤
        function toggleQuest(questId) {
            const questElement = document.getElementById(questId);
            if (questElement.style.display === 'none' || questElement.style.display === '') {
                questElement.style.display = 'block';
            } else {
                questElement.style.display = 'none';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
        document.addEventListener('DOMContentLoaded', () => {
            initShop();
            updateNextFruit();
            updateCollection();
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π Matter.js
        Events.on(engine, 'collisionStart', checkCollision);
        Events.on(engine, 'afterUpdate', checkGameOver);
    </script>
</body>
</html>
