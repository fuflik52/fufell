<html><head><base href="https://example.com" />
<title>Spooky Puppy Clicker</title>
<style>
body {
    background-color: #1a0f2e;
    color: #ff6b1a;
    font-family: 'Creepster', cursive;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M15 15c2-2 6-2 6 0l2 20c0 2-4 4-6 2l-2-22M75 15c-2-2-6-2-6 0l-2 20c0 2 4 4 6 2l2-22' fill='%23ff6b1a33'/%3E%3C/svg%3E");
}

.dog-container {
    cursor: pointer;
    margin: 20px;
    transition: transform 0.1s;
    filter: drop-shadow(0 0 10px #ff6b1a);
}

.dog-container:active {
    transform: scale(0.95);
}

.stats {
    background-color: #2a1f3d;
    border: 2px solid #ff6b1a;
    border-radius: 15px;
    padding: 20px;
    margin: 20px;
    text-align: center;
    font-size: 1.2em;
    text-shadow: 0 0 5px #ff6b1a;
    box-shadow: 0 0 15px #ff6b1a33;
}

.menu-buttons {
    display: flex;
    gap: 20px;
    margin-top: 20px;
    flex-wrap: wrap;
    justify-content: center;
}

.menu-button {
    background-color: #ff6b1a;
    color: #1a0f2e;
    border: none;
    border-radius: 10px;
    padding: 15px 30px;
    font-size: 1.1em;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Creepster', cursive;
    box-shadow: 0 0 10px #ff6b1a55;
}

.menu-button:hover {
    transform: scale(1.05);
    background-color: #ff8642;
    box-shadow: 0 0 20px #ff6b1a;
}

.dog {
    width: 120px;
    height: 120px;
}

#gameContainer {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: #1a0f2e;
    z-index: 1000;
    overflow-y: auto;
    padding: 20px;
}

.resources {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(26, 15, 46, 0.9);
    padding: 15px;
    display: flex;
    justify-content: center;
    gap: 20px;
    backdrop-filter: blur(10px);
    z-index: 100;
    border-bottom: 2px solid #ff6b1a;
}

.city {
    margin-top: 70px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    padding-bottom: 70px;
}

.building {
    background: rgba(255, 107, 26, 0.1);
    border-radius: 15px;
    padding: 15px;
    text-align: center;
    backdrop-filter: blur(5px);
    border: 2px solid #ff6b1a;
    transition: transform 0.3s, box-shadow 0.3s;
    position: relative;
    overflow: hidden;
    cursor: pointer;
}

.building:hover {
    transform: scale(1.02);
    box-shadow: 0 0 20px #ff6b1a55;
}

.building .icon {
    font-size: 3em;
    margin-bottom: 10px;
}

@keyframes float {
    0% {
        transform: translateY(0);
        opacity: 1;
    }
    100% {
        transform: translateY(-50px);
        opacity: 0;
    }
}

@keyframes spookyFloat {
    0% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-10px) rotate(5deg); }
    100% { transform: translateY(0) rotate(0deg); }
}

.dog-container {
    animation: spookyFloat 3s ease-in-out infinite;
}

.close-button {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #ff6b1a;
    color: #1a0f2e;
    border: none;
    border-radius: 10px;
    padding: 15px 30px;
    font-size: 1.1em;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Creepster', cursive;
    box-shadow: 0 0 10px #ff6b1a55;
    z-index: 1001;
}

.close-button:hover {
    transform: scale(1.05);
    background-color: #ff8642;
    box-shadow: 0 0 20px #ff6b1a;
}

#wardrobeContainer .wardrobe-items {
    max-height: 70vh;
    overflow-y: auto;
    padding: 20px;
}

.items-container {
    max-height: 80vh;
    overflow-y: auto;
    padding: 20px;
}

.item {
    padding: 20px;
    background: rgba(255, 107, 26, 0.1);
    border: 2px solid #ff6b1a;
    border-radius: 10px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    position: relative;
    min-height: 80px;
}

.item-info {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 15px;
}

.item .title {
    margin: 0 0 5px 0;
    font-size: 1.1em;
    word-wrap: break-word;
}

.item .details {
    font-size: 0.9em;
    margin: 0;
}

.item:hover {
    transform: scale(1.02);
    box-shadow: 0 8px 24px rgba(255, 107, 0, 0.3);
}

.icon {
    font-size: 2.5em;
    margin-right: 15px;
}

.question-mark {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    cursor: pointer;
    background: #ff6b1a;
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.tooltip {
    display: none;
    position: absolute;
    background: rgba(26, 15, 46, 0.95);
    border: 1px solid #ff6b1a;
    padding: 10px;
    border-radius: 8px;
    z-index: 100;
    left: 50%;
    transform: translateX(-50%);
    top: 100%;
    margin-top: 10px;
    width: 200px;
}

.notification {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(to right, #ff6b1a, #ff8642);
    color: white;
    padding: 15px 30px;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(255, 107, 26, 0.3);
    z-index: 2000;
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from {
        transform: translate(-50%, 100%);
        opacity: 0;
    }
    to {
        transform: translate(-50%, 0);
        opacity: 1;
    }
}

.claim-button {
    background: #ff6b1a;
    border: none;
    padding: 5px 15px;
    border-radius: 5px;
    color: white;
    cursor: pointer;
}

.building.elite {
    border: 2px solid gold;
    background: linear-gradient(135deg, rgba(255,107,26,0.2), rgba(255,215,0,0.2));
}

.elite-tag {
    position: absolute;
    top: -10px;
    right: -10px;
    background: gold;
    color: #1a0f2e;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.8em;
}

.new-tag {
    position: absolute;
    top: -10px;
    left: -10px;
    background: #ff6b1a;
    color: white;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.8em;
}

.shop-categories {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    justify-content: center;
}

.category-button {
    background: #ff6b1a;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
}

.category-button.active {
    background: #ff8642;
}

.price {
    color: #4CAF50;
    font-weight: bold;
}

.achievements-list {
    margin-top: 20px;
}

.achievement {
    background: rgba(255, 107, 26, 0.1);
    border: 2px solid #ff6b1a;
    border-radius: 10px;
    padding: 10px;
    margin: 5px 0;
}

.achievement.completed {
    background: rgba(0, 255, 0, 0.1);
}

.quests-list {
    margin-top: 20px;
}

.quest {
    background: rgba(255, 107, 26, 0.1);
    border: 2px solid #ff6b1a;
    border-radius: 10px;
    padding: 10px;
    margin: 5px 0;
}

.progress {
    background: rgba(255, 107, 26, 0.3);
    border-radius: 5px;
    height: 10px;
    overflow: hidden;
}

.progress-bar {
    background: #4CAF50;
    height: 100%;
}

#wardrobeContainer {
    display: none;
    background: linear-gradient(135deg, #1a0f2e 0%, #2d1b36 100%);
    border: 2px solid #ff6b1a;
    border-radius: 15px;
    padding: 20px;
    max-width: 90vw;
    width: 800px;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000;
}

.wardrobe-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    justify-content: center;
}

.wardrobe-tabs button {
    background: #ff6b1a;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
}

.wardrobe-tabs button.active {
    background: #ff8642;
}

.wardrobe-items {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.wardrobe-item {
    background: rgba(255, 107, 26, 0.1);
    border: 2px solid #ff6b1a;
    border-radius: 10px;
    padding: 15px;
    text-align: center;
}

.preview {
    width: 100px;
    height: 100px;
    margin: 10px auto;
    border-radius: 50%;
    border: 2px solid #ff6b1a;
}

.energy-bar {
    position: fixed;
    top: 10px;
    left: 10px;
    width: 200px;
    height: 20px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid #2ecc71;
    border-radius: 10px;
    overflow: hidden;
    z-index: 1000;
}

.energy-fill {
    height: 100%;
    background: #2ecc71;
    transition: width 0.3s;
}

.energy-text {
    position: absolute;
    width: 100%;
    text-align: center;
    color: white;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    line-height: 20px;
}

@media (max-width: 768px) {
    #wardrobeContainer {
        width: 95vw;
        max-height: 90vh;
    }
    
    .city {
        grid-template-columns: 1fr;
    }
    
    .menu-buttons {
        flex-direction: column;
    }
    
    .menu-button, .claim-button, .category-button, .close-button {
        width: 100%;
        margin: 5px 0;
    }
}

.building.elite.spacestation {
    border: 2px solid #4CAF50;
    background: linear-gradient(135deg, rgba(76,175,80,0.1), rgba(76,175,80,0.2));
}

#shopContainer {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #1a0f2e;
    border: 2px solid #ff6b1a;
    border-radius: 15px;
    padding: 20px;
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    z-index: 1000;
}
</style>
<link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">
</head>
<body>
    <div class="energy-bar">
        <div class="energy-fill"></div>
        <div class="energy-text">100/100</div>
    </div>

    <div class="dog-container" onclick="clickDog()">
        <svg class="dog" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" fill="#ff6b1a"/>
            <circle cx="40" cy="40" r="8" fill="#1a0f2e"/>
            <circle cx="60" cy="40" r="8" fill="#1a0f2e"/>
            <circle cx="50" cy="55" r="5" fill="#1a0f2e"/>
            <path d="M35,65 Q50,80 65,65" stroke="#1a0f2e" stroke-width="3" fill="none"/>
            <path d="M25,20 Q35,10 45,20" fill="#1a0f2e"/>
            <path d="M55,20 Q65,10 75,20" fill="#1a0f2e"/>
        </svg>
    </div>

    <div class="stats">
        <div>Тыквы: <span id="treats">0</span></div>
        <div>В секунду: <span id="perSecond">0.0</span></div>
        <div>Уровень: <span id="level">1</span></div>
        <div>Неоплаченные: <span id="unclaimed">0</span></div>
        <div>Энергия: <span id="energy">100</span>/<span>100</span></div>
    </div>

    <div class="menu-buttons">
        <button class="menu-button" onclick="openShop()">Магазин</button>
        <button class="menu-button" onclick="openAchievements()">Награды</button>
        <button class="menu-button" onclick="openQuests()">Задания</button>
        <button class="menu-button" onclick="openWardrobe()">Гардероб</button>
        <button class="menu-button" onclick="openTown()">Город</button>
    </div>

    <div id="shopContainer" style="display: none;">
        <div class="shop-categories">
            <button class="category-button active" onclick="showCategory('regular')">Обычные предметы</button>
            <button class="category-button" onclick="showCategory('premium')">Премиум предметы</button>
        </div>
        <div class="items-container">
            <div id="regularItems" class="category-section">
                <div class="item">
                    <div class="item-info">
                        <div class="icon">🎃</div>
                        <div>
                            <h3 class="title">Маленькая тыква</h3>
                            <p class="details">Цена: 100 тыкв</p>
                            <p class="details">Бонус: +1 к клику</p>
                        </div>
                    </div>
                    <button class="menu-button" onclick="purchaseItem('treat1')">Купить</button>
                </div>
                <div class="item">
                    <div class="item-info">
                        <div class="icon">🎃</div>
                        <div>
                            <h3 class="title">Большая тыква</h3>
                            <p class="details">Цена: 500 тыкв</p>
                            <p class="details">Бонус: +5 к клику</p>
                        </div>
                    </div>
                    <button class="menu-button" onclick="purchaseItem('treat2')">Купить</button>
                </div>
                <div class="item">
                    <div class="item-info">
                        <div class="icon">🎃</div>
                        <div>
                            <h3 class="title">Золотая тыква</h3>
                            <p class="details">Цена: 2000 тыкв</p>
                            <p class="details">Бонус: +25 к клику</p>
                        </div>
                    </div>
                    <button class="menu-button" onclick="purchaseItem('treat3')">Купить</button>
                </div>
                <div class="item">
                    <div class="item-info">
                        <div class="icon">⚡</div>
                        <div>
                            <h3 class="title">Энергетический напиток</h3>
                            <p class="details">Цена: 1000 тыкв</p>
                            <p class="details">Бонус: +50 энергии</p>
                        </div>
                    </div>
                    <button class="menu-button" onclick="purchaseItem('energyBoost')">Купить</button>
                </div>
                <div class="item">
                    <div class="item-info">
                        <div class="icon">🤖</div>
                        <div>
                            <h3 class="title">Автокликер</h3>
                            <p class="details">Цена: 5000 тыкв</p>
                            <p class="details">Бонус: +2 к клику</p>
                        </div>
                    </div>
                    <button class="menu-button" onclick="purchaseItem('autoClicker')">Купить</button>
                </div>
                <div class="item">
                    <div class="item-info">
                        <div class="icon">🍀</div>
                        <div>
                            <h3 class="title">Счастливый амулет</h3>
                            <p class="details">Цена: 3000 тыкв</p>
                            <p class="details">Бонус: +15 к клику</p>
                        </div>
                    </div>
                    <button class="menu-button" onclick="purchaseItem('luckyCharm')">Купить</button>
                </div>
            </div>
            <div id="premiumItems" class="category-section" style="display:none">
                ${generatePremiumItems()}
            </div>
        </div>
        <button class="close-button" onclick="closeShop()">Закрыть</button>
    </div>

    <div id="wardrobeContainer">
        <button class="close-button" onclick="closeWardrobe()">Закрыть</button>
        <div class="wardrobe-tabs">
            <button onclick="showWardrobeTab('colors')">Цвет Мячика</button>
            <button onclick="showWardrobeTab('backgrounds')">Фоны</button>
        </div>
        <div class="wardrobe-items"></div>
    </div>

    <div id="gameContainer">
        <button class="close-button" onclick="closeTown()">Закрыть</button>
        <div class="resources">
            <div class="money">🎃 <span id="money">0</span></div>
            <div class="income">👻 <span id="income">0</span>/10сек</div>
            <div class="unclaimed">💰 <span id="unclaimed">0</span></div>
            <button class="claim-button" onclick="claimIncome()">Получить (-10%)</button>
        </div>
        <div class="city" id="city"></div>
        <div class="notification" id="notification"></div>
        <div class="city" id="city"></div>
    </div>

<script>
function clickDog() {
    if (energy.current >= energy.clickCost) {
        energy.current -= energy.clickCost;
        energy.spent += energy.clickCost;
        treats += clickPower;
        clicks++;
        updateQuestProgress('clicks', 1);
        updateDisplay();
        saveGame();
        
        // Create and animate floating number
        const dogContainer = document.querySelector('.dog-container');
        const floatingNumber = document.createElement('div');
        floatingNumber.textContent = `+${clickPower}`;
        floatingNumber.style.position = 'absolute';
        floatingNumber.style.left = '50%';
        floatingNumber.style.transform = 'translateX(-50%)';
        floatingNumber.style.animation = 'float 1s ease-out';
        floatingNumber.style.color = '#ff6b1a';
        floatingNumber.style.fontSize = '20px';
        floatingNumber.style.pointerEvents = 'none';
        dogContainer.appendChild(floatingNumber);
        
        // Remove the element after animation
        setTimeout(() => {
            floatingNumber.remove();
        }, 1000);
    } else {
        showNotification('Недостаточно энергии!');
    }
}

function calculateOfflineProgress() {
    const lastPlayTime = localStorage.getItem('lastPlayTime');
    if (lastPlayTime) {
        const offlineTime = (Date.now() - parseInt(lastPlayTime)) / 1000; // Convert to seconds
        const offlineEarnings = Math.floor(perSecond * offlineTime);
        if (offlineEarnings > 0) {
            treats += offlineEarnings;
            showNotification(`Пока вы отсутствовали: +${formatNumber(offlineEarnings)} тыкв!`);
        }

        // Calculate offline energy regeneration
        const energyGained = Math.floor(offlineTime * 2); // 2 energy per second
        energy.current = Math.min(energy.current + energyGained, energy.max);
    }
    localStorage.setItem('lastPlayTime', Date.now().toString());
}

function startEnergyRegen() {
    energyRegenInterval = setInterval(() => {
        if (energy.current < energy.max) {
            energy.current = Math.min(energy.current + energy.regenRate, energy.max);
            updateDisplay();
            saveGame();
        }
    }, 500);
}

function openShop() {
    const container = document.getElementById('shopContainer');
    container.style.display = 'block';
    // Clean up the items containers
    document.getElementById('regularItems').innerHTML = generateRegularItems();
    document.getElementById('premiumItems').innerHTML = generatePremiumItems();
    showCategory('regular'); // Show regular items by default
}

function closeShop() {
    document.getElementById('shopContainer').style.display = 'none';
}

function showCategory(category) {
    // Get all category buttons and remove active class
    document.querySelectorAll('.category-button').forEach(button => {
        button.classList.remove('active');
    });
    
    // Add active class to selected category button
    document.querySelector(`.category-button[onclick*="${category}"]`).classList.add('active');
    
    // Hide all category sections
    document.querySelectorAll('.category-section').forEach(section => {
        section.style.display = 'none';
    });
    
    // Show selected category section
    document.getElementById(`${category}Items`).style.display = 'block';
}

function generateRegularItems() {
    const items = [
        { id: 'treat1', name: 'Маленькая тыква', price: 100, boost: 1, icon: '🎃' },
        { id: 'treat2', name: 'Большая тыква', price: 500, boost: 5, icon: '🎃' },
        { id: 'treat3', name: 'Золотая тыква', price: 2000, boost: 25, icon: '🎃' },
        { id: 'energyBoost', name: 'Энергетический напиток', price: 1000, type: 'energy', boost: 50, icon: '⚡' },
        { id: 'autoClicker', name: 'Автокликер', price: 5000, boost: 2, icon: '🤖' },
        { id: 'luckyCharm', name: 'Счастливый амулет', price: 3000, boost: 15, icon: '🍀' }
    ];

    return items.map(item => `
        <div class="item">
            <div class="item-info">
                <div class="icon">${item.icon}</div>
                <div>
                    <h3 class="title">${item.name}</h3>
                    <p class="details">Цена: ${formatNumber(item.price)} тыкв</p>
                    <p class="details">Бонус: +${item.boost} ${item.type === 'energy' ? 'энергии' : 'к клику'}</p>
                </div>
            </div>
            <button class="menu-button" onclick="purchaseItem('${item.id}')">Купить</button>
        </div>
    `).join('');
}

function generatePremiumItems() {
    const items = [
        { id: 'goldenPup', name: 'Золотой щенок', price: 10000, boost: 100 },
        { id: 'rainbowPup', name: 'Радужный щенок', price: 50000, boost: 500 },
        { id: 'ghostPup', name: 'Призрачный щенок', price: 100000, boost: 1000 }
    ];

    return items.map(item => `
        <div class="item">
            <div class="item-info">
                <div class="icon">✨</div>
                <div>
                    <h3 class="title">${item.name}</h3>
                    <p class="details">Цена: ${formatNumber(item.price)} тыкв</p>
                    <p class="details">Бонус: +${item.boost} к клику</p>
                </div>
            </div>
            ${purchasedPremiumItems.includes(item.id) ?
                '<button class="menu-button" disabled>Куплено</button>' :
                `<button class="menu-button" onclick="purchasePremiumItem('${item.id}')">Купить</button>`
            }
        </div>
    `).join('');
}

function purchaseItem(itemId) {
    const items = {
        'treat1': { price: 100, boost: 1 },
        'treat2': { price: 500, boost: 5 },
        'treat3': { price: 2000, boost: 25 },
        'energyBoost': { price: 1000, boost: 50, type: 'energy' },
        'autoClicker': { price: 5000, boost: 2 },
        'luckyCharm': { price: 3000, boost: 15 }
    };

    const item = items[itemId];
    if (treats >= item.price) {
        treats -= item.price;
        if (item.type === 'energy') {
            energy.current = Math.min(energy.current + item.boost, energy.max);
        } else {
            clickPower += item.boost;
        }
        showNotification(`Куплено: ${itemId}!`);
        updateDisplay();
        saveGame();
    } else {
        showNotification('Недостаточно тыкв!');
    }
}

function purchasePremiumItem(itemId) {
    const items = {
        'goldenPup': { price: 10000, boost: 100 },
        'rainbowPup': { price: 50000, boost: 500 },
        'ghostPup': { price: 100000, boost: 1000 }
    };

    const item = items[itemId];
    if (treats >= item.price && !purchasedPremiumItems.includes(itemId)) {
        treats -= item.price;
        clickPower += item.boost;
        purchasedPremiumItems.push(itemId);
        showNotification(`Куплено: ${itemId}!`);
        updateDisplay();
        saveGame();
        openShop(); // Refresh shop display
    } else if (purchasedPremiumItems.includes(itemId)) {
        showNotification('Уже куплено!');
    } else {
        showNotification('Недостаточно тыкв!');
    }
}

function generateAchievements() {
    const achievementList = [
        { id: 'clicks100', name: 'Начинающий кликер', description: 'Кликни 100 раз', reward: 500 },
        { id: 'treats1000', name: 'Тыквенный король', description: 'Накопи 1000 тыкв', reward: 1000 },
        { id: 'energy500', name: 'Энергичный', description: 'Потрать 500 энергии', reward: 2000 }
    ];

    return achievementList.map(achievement => `
        <div class="achievement ${achievements.includes(achievement.id) ? 'completed' : ''}">
            <h3>${achievement.name}</h3>
            <p>${achievement.description}</p>
            <p>Награда: ${achievement.reward} тыкв</p>
            ${achievements.includes(achievement.id) ? 
                '<p>✅ Получено!</p>' : 
                `<button class="claim-button" onclick="claimAchievement('${achievement.id}', ${achievement.reward})">Получить</button>`
            }
        </div>
    `).join('');
}

function openAchievements() {
    const container = document.getElementById('gameContainer');
    container.style.display = 'block';
    container.innerHTML = `
        <button class="close-button" onclick="closeAchievements()">Закрыть</button>
        <div class="achievements-list">
            <h2>Достижения</h2>
            ${generateAchievements()}
        </div>
    `;
}

function closeAchievements() {
    document.getElementById('gameContainer').style.display = 'none';
}

function purchaseWardrobeItem(category, itemId) {
    const item = wardrobeItems[category].find(i => i.id === itemId);
    if (!item) {
        showNotification('Предмет не найден!');
        return;
    }

    if (treats >= item.price) {
        if (!purchasedWardrobeItems[category].includes(itemId)) {
            treats -= item.price;
            purchasedWardrobeItems[category].push(itemId);
            showNotification(`Куплено: ${item.name}!`);
            updateDisplay();
            saveGame();
            showWardrobeItems(category, wardrobeItems[category]); // Refresh wardrobe display
        } else {
            showNotification('Этот предмет уже куплен!');
        }
    } else {
        showNotification('Недостаточно тыкв!');
    }
}

function openWardrobe() {
    const container = document.getElementById('wardrobeContainer');
    if (!container) return;
    
    container.style.display = 'block';
    
    // Show colors tab by default
    showWardrobeTab('colors');
}

function closeWardrobe() {
    document.getElementById('wardrobeContainer').style.display = 'none';
}

function showWardrobeTab(category) {
    // Get all tab buttons and remove active class
    document.querySelectorAll('.wardrobe-tabs button').forEach(button => {
        button.classList.remove('active');
    });
    
    // Add active class to selected tab button
    document.querySelector(`.wardrobe-tabs button[onclick*="${category}"]`).classList.add('active');
    
    // Show items for selected category
    showWardrobeItems(category, wardrobeItems[category]);
}

function claimAchievement(achievementId, reward) {
    if (!achievements.includes(achievementId)) {
        achievements.push(achievementId);
        treats += reward;
        showNotification(`Получено достижение! +${reward} тыкв`);
        saveGame();
        openAchievements(); // Refresh achievements display
    }
}

function showNotification(message) {
    const notification = document.getElementById('notification');
    if (notification) {
        notification.textContent = message;
        notification.style.display = 'block';
        setTimeout(() => {
            notification.style.display = 'none';
        }, 3000);
    } else {
        // Create notification element if it doesn't exist
        const newNotification = document.createElement('div');
        newNotification.id = 'notification';
        newNotification.className = 'notification';
        newNotification.textContent = message;
        document.body.appendChild(newNotification);
        setTimeout(() => {
            newNotification.remove();
        }, 3000);
    }
}

let treats = 0;
let perSecond = 0;
let clickPower = 1;
let level = 1;
let clicks = 0;
let purchasedPremiumItems = [];
let energy = {
    current: 100,
    max: 100,
    clickCost: 1,
    regenRate: 1,
    spent: 0
};
let purchasedWardrobeItems = {
    colors: [],
    backgrounds: []
};
let gameState = {
    money: 0,
    buildings: {},
    unclaimedIncome: 0
};
let shopItems = [];
let achievements = [];
let quests = [
    {
        id: 'quest1',
        name: 'Начинающий кликер',
        description: 'Кликни 100 раз',
        target: 100,
        reward: 500,
        progress: 0,
        type: 'clicks'
    },
    {
        id: 'quest2',
        name: 'Копилка тыкв',
        description: 'Накопи 1000 тыкв',
        target: 1000,
        reward: 200,
        progress: 0,
        type: 'treats'
    },
    {
        id: 'quest3',
        name: 'Энергичный щенок',
        description: 'Потрать 500 энергии',
        target: 500,
        reward: 1000,
        progress: 0,
        type: 'energy'
    }
];

function openQuests() {
    const container = document.getElementById('gameContainer');
    container.style.display = 'block';
    container.innerHTML = `
        <button class="close-button" onclick="closeQuests()">Закрыть</button>
        <div class="quests-list">
            <h2>Задания</h2>
            ${generateQuests()}
        </div>
    `;
}
function generateQuests() {
    return quests.map(quest => {
        const progress = (quest.progress / quest.target) * 100;
        const isCompleted = quest.progress >= quest.target;
        return `
            <div class="quest ${isCompleted ? 'completed' : ''}">
                <h3>${quest.name}</h3>
                <p>${quest.description}</p>
                <div class="progress">
                    <div class="progress-bar" style="width: ${progress}%"></div>
                </div>
                <p>Прогресс: ${quest.progress}/${quest.target}</p>
                <p>Награда: ${quest.reward} тыкв</p>
                ${isCompleted ? 
                    `<button class="claim-button" onclick="claimQuest('${quest.id}')">Получить награду</button>` : 
                    ''
                }
            </div>
        `;
    }).join('');
}

function claimIncome() {
    if (gameState.unclaimedIncome > 0) {
        // Apply 10% penalty for claiming
        const claimAmount = Math.floor(gameState.unclaimedIncome * 0.9);
        treats += claimAmount;
        gameState.unclaimedIncome = 0;
        showNotification(`Получено ${formatNumber(claimAmount)} тыкв!`);
        updateDisplay();
        saveGame();
    } else {
        showNotification('Нечего получать!');
    }
}

function closeQuests() {
    document.getElementById('gameContainer').style.display = 'none';
}

function claimQuest(questId) {
    const quest = quests.find(q => q.id === questId);
    if (quest && quest.progress >= quest.target) {
        treats += quest.reward;
        quest.progress = 0; // Reset progress after claiming
        showNotification(`Получено ${quest.reward} тыкв за выполнение задания!`);
        saveGame();
        openQuests(); // Refresh quests display
    }
}

// Add automatic income generation every 10 seconds
setInterval(() => {
    const generatedIncome = perSecond * 10; // Generate 10 seconds worth of income
    if (generatedIncome > 0) {
        gameState.unclaimedIncome += generatedIncome;
        updateDisplay();
        saveGame();
    }
}, 10000);

function updateQuestProgress(type, amount) {
    quests.forEach(quest => {
        if (quest.type === type && quest.progress < quest.target) {
            quest.progress += amount;
            if (quest.progress >= quest.target) {
                showNotification('Задание выполнено! Нажмите на кнопку "Задания" чтобы получить награду.');
            }
        }
    });
    saveGame();
}

const wardrobeItems = {
    colors: [
        { id: '#ff6b1a', name: 'Оранжевый', price: 1000 },
        { id: '#ff3333', name: 'Красный', price: 1000 },
        { id: '#3366ff', name: 'Синий', price: 1000 },
        { id: '#33cc33', name: 'Зеленый', price: 1000 },
        { id: '#9933ff', name: 'Фиолетовый', price: 1000 },
        { id: 'linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet)', name: 'Радужный', price: 5000 }
    ],
    backgrounds: [
        { 
            id: 'haunted', 
            name: 'Жуткий дом', 
            price: 2000, 
            style: `
                background-color: #1a0f2e;
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M60,180 L100,100 L140,180 Z M80,180 v-40 h40 v40' fill='%23ff6b1a33'/%3E%3C/svg%3E");
                background-size: 200px;
            `
        },
        { 
            id: 'graveyard', 
            name: 'Кладбище', 
            price: 2000, 
            style: `
                background-color: #1a0f2e;
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cpath d='M40,80 v-30 h20 v30 M30,50 h40 l-20,-30 z' fill='%23ff6b1a33'/%3E%3C/svg%3E");
                background-size: 100px;
            `
        },
        { 
            id: 'pumpkin_patch', 
            name: 'Тыквенное поле', 
            price: 2000, 
            style: `
                background-color: #1a0f2e;
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Ccircle cx='50' cy='50' r='25' fill='%23ff6b1a33'/%3E%3Cpath d='M50,25 v-10 q10,-10 20,0' fill='%23ff6b1a33'/%3E%3C/svg%3E");
                background-size: 100px;
            `
        },
        { 
            id: 'spooky_forest', 
            name: 'Жуткий лес', 
            price: 2000, 
            style: `
                background-color: #1a0f2e;
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='150'%3E%3Cpath d='M30,120 v-60 l30,-30 l30,30 v60 M90,120 v-40 l20,-20 l20,20 v40' fill='%23ff6b1a33'/%3E%3C/svg%3E");
                background-size: 150px;
            `
        }
    ]
};

function showWardrobeItems(category, items) {
    const container = document.querySelector('.wardrobe-items');
    container.innerHTML = items.map(item => `
        <div class="wardrobe-item">
            ${category === 'colors' ? 
                `<div class="preview" style="background: ${item.id}"></div>` :
                `<div class="preview" style="${item.style}"></div>`
            }
            <h3>${item.name}</h3>
            <p>${formatNumber(item.price)} тыкв</p>
            ${purchasedWardrobeItems[category].includes(item.id) ?
                '<button class="menu-button" onclick="equipItem(\'' + category + '\', \'' + item.id + '\')">Надеть</button>' :
                '<button class="menu-button" onclick="purchaseWardrobeItem(\'' + category + '\', \'' + item.id + '\')">Купить</button>'
            }
        </div>
    `).join('');
}

function equipItem(category, itemId) {
    const item = wardrobeItems[category].find(i => i.id === itemId);
    if (!item) return;

    if (category === 'colors') {
        document.querySelector('.dog circle:first-child').style.fill = item.id;
    } else if (category === 'backgrounds') {
        document.body.style = item.style;
    }
    showNotification('Предмет надет!');
}

function loadGame() {
    const savedData = localStorage.getItem('gameData');
    if (savedData) {
        const gameData = JSON.parse(savedData);
        treats = gameData.treats || 0;
        perSecond = gameData.perSecond || 0;
        clickPower = gameData.clickPower || 1;
        level = gameData.level || 1;
        clicks = gameData.clicks || 0;
        purchasedPremiumItems = gameData.purchasedPremiumItems || [];
        energy = gameData.energy || {
            current: 100,
            max: 100,
            clickCost: 1,
            regenRate: 1,
            spent: 0
        };
        purchasedWardrobeItems = gameData.purchasedWardrobeItems || {
            colors: [],
            backgrounds: []
        };
        gameState = gameData.gameState || {
            money: 0,
            buildings: {},
            unclaimedIncome: 0
        };

        // Update quest progress while keeping original quest definitions
        if (gameData.quests) {
            quests.forEach((quest, index) => {
                if (gameData.quests[index]) {
                    quest.progress = gameData.quests[index].progress;
                }
            });
        }

        if (gameData.achievements) {
            achievements = gameData.achievements;
        }
        if (gameData.shopItems) {
            shopItems = gameData.shopItems;
        }

        calculateOfflineProgress();
        updateDisplay();
        startEnergyRegen();
    }
}

function saveGame() {
    const gameData = {
        treats,
        perSecond,
        clickPower,
        level,
        clicks,
        purchasedPremiumItems,
        energy,
        purchasedWardrobeItems,
        gameState,
        quests,
        achievements,
        shopItems
    };
    localStorage.setItem('gameData', JSON.stringify(gameData));
    localStorage.setItem('lastPlayTime', Date.now().toString());
}

function formatNumber(num) {
    if (num >= 1e6) {
        return (num / 1e6).toFixed(1) + 'M';
    } else if (num >= 1e3) {
        return (num / 1e3).toFixed(1) + 'K';
    } else {
        return num.toString();
    }
}

function updateDisplay() {
    // Update treats and per second display
    const treatsElement = document.getElementById('treats');
    const perSecondElement = document.getElementById('perSecond');
    const levelElement = document.getElementById('level');
    const unclaimedElement = document.getElementById('unclaimed');
    const energyElement = document.getElementById('energy');
    
    if (treatsElement) treatsElement.textContent = formatNumber(treats);
    if (perSecondElement) perSecondElement.textContent = formatNumber(perSecond);
    if (levelElement) levelElement.textContent = level;
    if (unclaimedElement) unclaimedElement.textContent = formatNumber(gameState.unclaimedIncome);
    
    // Update energy display
    if (energyElement) energyElement.textContent = Math.floor(energy.current);
    
    const energyFill = document.querySelector('.energy-fill');
    const energyText = document.querySelector('.energy-text');
    if (energyFill && energyText) {
        const percentage = (energy.current / energy.max) * 100;
        energyFill.style.width = `${percentage}%`;
        energyText.textContent = `${Math.floor(energy.current)}/${energy.max}`;
    }
}

function openTown() {
    // Close other containers first
    document.getElementById('shopContainer').style.display = 'none';
    
    const container = document.getElementById('gameContainer');
    container.style.display = 'block';
    container.innerHTML = `
        <button class="close-button" onclick="closeTown()">Закрыть</button>
        <div class="resources">
            <div class="money">🎃 <span id="money">0</span></div>
            <div class="income">👻 <span id="income">0</span>/10сек</div>
            <div class="unclaimed">💰 <span id="unclaimed">0</span></div>
            <button class="claim-button" onclick="claimIncome()">Получить (-10%)</button>
        </div>
        <div class="city" id="city"></div>
    `;
    
    // Generate town buildings
    const city = document.getElementById('city');
    if (city) {
        city.innerHTML = generateTownBuildings();
    }
    updateDisplay();
}

function generateTownBuildings() {
    let buildings = '';
    const buildingTypes = {
        'house': { name: 'Домик', baseIncome: 10, baseCost: 100, icon: '🏠' },
        'shop': { name: 'Магазин', baseIncome: 30, baseCost: 300, icon: '🏪' },
        'factory': { name: 'Фабрика', baseIncome: 100, baseCost: 1000, icon: '🏭' },
        'mansion': { name: 'Особняк', baseIncome: 300, baseCost: 3000, icon: '🏰' },
        'tower': { name: 'Башня', baseIncome: 1000, baseCost: 10000, icon: '🗼' }
    };

    for (let [type, data] of Object.entries(buildingTypes)) {
        const owned = gameState.buildings[type] || 0;
        const cost = Math.floor(data.baseCost * Math.pow(1.15, owned));
        const income = data.baseIncome * owned;

        buildings += `
            <div class="building" onclick="buyBuilding('${type}')">
                <div class="icon">${data.icon}</div>
                <h3>${data.name}</h3>
                <p>Стоимость: ${formatNumber(cost)} 🎃</p>
                <p>Доход: ${formatNumber(data.baseIncome)}/10сек</p>
                <p>Принадлежит: ${owned}</p>
            </div>
        `;
    }
    return buildings;
}

function buyBuilding(type) {
    const buildingTypes = {
        'house': { baseCost: 100, baseIncome: 10 },
        'shop': { baseCost: 300, baseIncome: 30 },
        'factory': { baseCost: 1000, baseIncome: 100 },
        'mansion': { baseCost: 3000, baseIncome: 300 },
        'tower': { baseCost: 10000, baseIncome: 1000 }
    };

    const owned = gameState.buildings[type] || 0;
    const cost = Math.floor(buildingTypes[type].baseCost * Math.pow(1.15, owned));

    if (treats >= cost) {
        treats -= cost;
        gameState.buildings[type] = (gameState.buildings[type] || 0) + 1;
        updateIncomeRate();
        showNotification(`Куплено: ${type}!`);
        openTown(); // Refresh town display
        saveGame();
    } else {
        showNotification('Недостаточно тыкв!');
    }
}

function updateIncomeRate() {
    let totalIncome = 0;
    const buildingTypes = {
        'house': { baseIncome: 10 },
        'shop': { baseIncome: 30 },
        'factory': { baseIncome: 100 },
        'mansion': { baseIncome: 300 },
        'tower': { baseIncome: 1000 }
    };

    for (let [type, data] of Object.entries(buildingTypes)) {
        if (gameState.buildings[type]) {
            totalIncome += data.baseIncome * gameState.buildings[type];
        }
    }
    
    perSecond = totalIncome / 10; // Convert to per-second rate
    updateDisplay();
}

function closeTown() {
    document.getElementById('gameContainer').style.display = 'none';
}

// Add this line at the end of the script to load saved game on page load
window.addEventListener('load', loadGame);
</script>
</body>
</html>
