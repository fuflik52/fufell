<html><head><base href="https://example.com" />
<title>Spooky Puppy Clicker</title>


  @media (max-width: 768px) {
      body {
          background-color: lightblue;
      }
  }
  

    
<style>
body {
    background-color: #1a0f2e;
    color: #ff6b1a;
    font-family: 'Creepster', cursive;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M15 15c2-2 6-2 6 0l2 20c0 2-4 4-6 2l-2-22M75 15c-2-2-6-2-6 0l-2 20c0 2 4 4 6 2l2-22' fill='%23ff6b1a33'/%3E%3C/svg%3E");
}

.dog-container {
    cursor: pointer;
    margin: 20px;
    transition: transform 0.1s;
    filter: drop-shadow(0 0 10px #ff6b1a);
}

.dog-container:active {
    transform: scale(0.95);
}

.stats {
    background-color: #2a1f3d;
    border: 2px solid #ff6b1a;
    border-radius: 15px;
    padding: 20px;
    margin: 20px;
    text-align: center;
    font-size: 1.2em;
    text-shadow: 0 0 5px #ff6b1a;
    box-shadow: 0 0 15px #ff6b1a33;
}

.menu-buttons {
    display: flex;
    gap: 20px;
    margin-top: 20px;
    flex-wrap: wrap;
    justify-content: center;
}

.menu-button {
    background-color: #ff6b1a;
    color: #1a0f2e;
    border: none;
    border-radius: 10px;
    padding: 15px 30px;
    font-size: 1.1em;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Creepster', cursive;
    box-shadow: 0 0 10px #ff6b1a55;
}

.menu-button:hover {
    transform: scale(1.05);
    background-color: #ff8642;
    box-shadow: 0 0 20px #ff6b1a;
}

.dog {
    width: 120px;
    height: 120px;
}

#gameContainer {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: #1a0f2e;
    z-index: 1000;
    overflow-y: auto;
    padding: 20px;
}

.resources {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(26, 15, 46, 0.9);
    padding: 15px;
    display: flex;
    justify-content: center;
    gap: 20px;
    backdrop-filter: blur(10px);
    z-index: 100;
    border-bottom: 2px solid #ff6b1a;
}

.city {
    margin-top: 70px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    padding-bottom: 70px;
}

.building {
    background: rgba(255, 107, 26, 0.1);
    border-radius: 15px;
    padding: 15px;
    text-align: center;
    backdrop-filter: blur(5px);
    border: 2px solid #ff6b1a;
    transition: transform 0.3s, box-shadow 0.3s;
    position: relative;
    overflow: hidden;
    cursor: pointer;
}

.building:hover {
    transform: scale(1.02);
    box-shadow: 0 0 20px #ff6b1a55;
}

.building .icon {
    font-size: 3em;
    margin-bottom: 10px;
}

@keyframes float {
    0% {
        transform: translateY(0);
        opacity: 1;
    }
    100% {
        transform: translateY(-50px);
        opacity: 0;
    }
}

@keyframes spookyFloat {
    0% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-10px) rotate(5deg); }
    100% { transform: translateY(0) rotate(0deg); }
}

.dog-container {
    animation: spookyFloat 3s ease-in-out infinite;
}

.close-button {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #ff6b1a;
    color: #1a0f2e;
    border: none;
    border-radius: 10px;
    padding: 15px 30px;
    font-size: 1.1em;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Creepster', cursive;
    box-shadow: 0 0 10px #ff6b1a55;
    z-index: 1001;
}

.close-button:hover {
    transform: scale(1.05);
    background-color: #ff8642;
    box-shadow: 0 0 20px #ff6b1a;
}

#wardrobeContainer .wardrobe-items {
    max-height: 70vh;
    overflow-y: auto;
    padding: 20px;
}

.items-container {
    max-height: 80vh;
    overflow-y: auto;
    padding: 20px;
}

.item {
    padding: 20px;
    background: rgba(255, 107, 26, 0.1);
    border: 2px solid #ff6b1a;
    border-radius: 10px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    position: relative;
    min-height: 80px;
}

.item-info {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 15px;
}

.item .title {
    margin: 0 0 5px 0;
    font-size: 1.1em;
    word-wrap: break-word;
}

.item .details {
    font-size: 0.9em;
    margin: 0;
}

.item:hover {
    transform: scale(1.02);
    box-shadow: 0 8px 24px rgba(255, 107, 0, 0.3);
}

.icon {
    font-size: 2.5em;
    margin-right: 15px;
}

.question-mark {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    cursor: pointer;
    background: #ff6b1a;
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.tooltip {
    display: none;
    position: absolute;
    background: rgba(26, 15, 46, 0.95);
    border: 1px solid #ff6b1a;
    padding: 10px;
    border-radius: 8px;
    z-index: 100;
    left: 50%;
    transform: translateX(-50%);
    top: 100%;
    margin-top: 10px;
    width: 200px;
}

.notification {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(to right, #ff6b1a, #ff8642);
    color: white;
    padding: 15px 30px;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(255, 107, 26, 0.3);
    z-index: 2000;
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from {
        transform: translate(-50%, 100%);
        opacity: 0;
    }
    to {
        transform: translate(-50%, 0);
        opacity: 1;
    }
}

.claim-button {
    background: #ff6b1a;
    border: none;
    padding: 5px 15px;
    border-radius: 5px;
    color: white;
    cursor: pointer;
}

.building.elite {
    border: 2px solid gold;
    background: linear-gradient(135deg, rgba(255,107,26,0.2), rgba(255,215,0,0.2));
}

.elite-tag {
    position: absolute;
    top: -10px;
    right: -10px;
    background: gold;
    color: #1a0f2e;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.8em;
}

.new-tag {
    position: absolute;
    top: -10px;
    left: -10px;
    background: #ff6b1a;
    color: white;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.8em;
}

.shop-categories {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    justify-content: center;
}

.category-button {
    background: #ff6b1a;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
}

.category-button.active {
    background: #ff8642;
}

.price {
    color: #4CAF50;
    font-weight: bold;
}

.achievements-list {
    margin-top: 20px;
}

.achievement {
    background: rgba(255, 107, 26, 0.1);
    border: 2px solid #ff6b1a;
    border-radius: 10px;
    padding: 10px;
    margin: 5px 0;
}

.achievement.completed {
    background: rgba(0, 255, 0, 0.1);
}

.quests-list {
    margin-top: 20px;
}

.quest {
    background: rgba(255, 107, 26, 0.1);
    border: 2px solid #ff6b1a;
    border-radius: 10px;
    padding: 10px;
    margin: 5px 0;
}

.progress {
    background: rgba(255, 107, 26, 0.3);
    border-radius: 5px;
    height: 10px;
    overflow: hidden;
}

.progress-bar {
    background: #4CAF50;
    height: 100%;
}

#wardrobeContainer {
    display: none;
    background: linear-gradient(135deg, #1a0f2e 0%, #2d1b36 100%);
    border: 2px solid #ff6b1a;
    border-radius: 15px;
    padding: 20px;
    max-width: 90vw;
    width: 800px;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000;
}

.wardrobe-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    justify-content: center;
}

.wardrobe-tabs button {
    background: #ff6b1a;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
}

.wardrobe-tabs button.active {
    background: #ff8642;
}

.wardrobe-items {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.wardrobe-item {
    background: rgba(255, 107, 26, 0.1);
    border: 2px solid #ff6b1a;
    border-radius: 10px;
    padding: 15px;
    text-align: center;
}

.preview {
    width: 100px;
    height: 100px;
    margin: 10px auto;
    border-radius: 50%;
    border: 2px solid #ff6b1a;
}

@media (max-width: 768px) {
    #wardrobeContainer {
        width: 95vw;
        max-height: 90vh;
    }
    
    .city {
        grid-template-columns: 1fr;
    }
    
    .menu-buttons {
        flex-direction: column;
    }
    
    .menu-button {
        width: 100%;
    }
}

.building.elite.spacestation {
    border: 2px solid #4CAF50;
    background: linear-gradient(135deg, rgba(76,175,80,0.1), rgba(76,175,80,0.2));
}
</style>
<link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dog-container" onclick="clickDog()">
        <svg class="dog" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" fill="#ff6b1a"/>
            <circle cx="40" cy="40" r="8" fill="#1a0f2e"/>
            <circle cx="60" cy="40" r="8" fill="#1a0f2e"/>
            <circle cx="50" cy="55" r="5" fill="#1a0f2e"/>
            <path d="M35,65 Q50,80 65,65" stroke="#1a0f2e" stroke-width="3" fill="none"/>
            <path d="M25,20 Q35,10 45,20" fill="#1a0f2e"/>
            <path d="M55,20 Q65,10 75,20" fill="#1a0f2e"/>
        </svg>
    </div>

    <div class="stats">
        <div>Тыквы: <span id="treats">0</span></div>
        <div>В секунду: <span id="perSecond">0.0</span></div>
        <div>Уровень: <span id="level">1</span></div>
        <div>Неоплаченные: <span id="unclaimed">0</span></div>
    </div>

    <div class="menu-buttons">
        <button class="menu-button" onclick="openShop()">Магазин</button>
        <button class="menu-button" onclick="openAchievements()">Награды</button>
        <button class="menu-button" onclick="openQuests()">Задания</button>
        <button class="menu-button" onclick="openWardrobe()">Гардероб</button>
        <button class="menu-button" onclick="openTown()">Город</button>
    </div>

    <div id="shopContainer">
        <div class="shop-categories">
            <button class="category-button active" onclick="showCategory('regular')">Обычные предметы</button>
            <button class="category-button" onclick="showCategory('premium')">Премиум предметы</button>
        </div>
        <div class="items-container">
            <div id="regularItems" class="category-section">
                ${generateRegularItems()}
            </div>
            <div id="premiumItems" class="category-section" style="display:none">
                ${generatePremiumItems()}
            </div>
        </div>
        <button class="close-button" onclick="closeShop()">Закрыть</button>
    </div>

    <div id="wardrobeContainer">
        <div class="wardrobe-tabs">
            <button onclick="showWardrobeTab('colors')">Цвет Мячика</button>
            <button onclick="showWardrobeTab('backgrounds')">Фоны</button>
        </div>
        <div class="wardrobe-items"></div>
    </div>

    <div id="gameContainer">
        <button class="close-button" onclick="closeTown()">Закрыть</button>
        <div class="resources">
            <div class="money">🎃 <span id="money">0</span></div>
            <div class="income">👻 <span id="income">0</span>/10сек</div>
            <div class="unclaimed">💰 <span id="unclaimed">0</span></div>
            <button class="claim-button" onclick="claimIncome()">Получить (-10%)</button>
        </div>
        <div class="city" id="city"></div>
        <div class="notification" id="notification"></div>
    </div>

<script>
let treats = 0;
let perSecond = 0; 
let clickPower = 1;
let level = 1;
let clicks = 0;
let purchasedPremiumItems = [];
const buildings = [
    {
        id: 1,
        name: "Жуткий дом",
        icon: "🏚️",
        baseIncome: 1,
        baseCost: 10,
        multiplier: 1.1
    },
    {
        id: 2,
        name: "Лавка ведьмы",
        icon: "🧙‍♀️",
        baseIncome: 4,
        baseCost: 50,
        multiplier: 1.15
    },
    {
        id: 3,
        name: "Башня призраков",
        icon: "👻",
        baseIncome: 10,
        baseCost: 200,
        multiplier: 1.2
    },
    {
        id: 4,
        name: "Фабрика монстров",
        icon: "👹",
        baseIncome: 40,
        baseCost: 1000,
        multiplier: 1.25
    },
    {
        id: 5,
        name: "Портал Теней",
        icon: "🌀",
        baseIncome: 100,
        baseCost: 5000,
        multiplier: 1.3,
        elite: true,
        isNew: true
    },
    {
        id: 6,
        name: "Замок Вампиров",
        icon: "🏰",
        baseIncome: 250,
        baseCost: 25000,
        multiplier: 1.35,
        elite: true,
        isNew: true
    },
    {
        id: 7,
        name: "Некрополис",
        icon: "💀",
        baseIncome: 1000,
        baseCost: 100000,
        multiplier: 1.4,
        elite: true,
        isNew: true
    },
    {
        id: 8,
        name: "Космодром",
        icon: "🚀",
        baseIncome: 50000,
        baseCost: 100000000,
        multiplier: 1.5,
        elite: true,
        isNew: true
    },
    {
        id: 9,
        name: "Космическая станция",
        icon: "🛰️",
        baseIncome: 50000,
        baseCost: 100000000,
        multiplier: 1.5,
        elite: true,
        isNew: true
    }
];

const quests = [
    { id: 1, name: "Начинающий кликер", description: "Кликни 1000 раз", progress: 0, goal: 1000 },
    { id: 2, name: "Коллекционер тыкв", description: "Собери 10000 тыкв", progress: 0, goal: 10000 },
    { id: 3, name: "Строитель города", description: "Построй 10 зданий", progress: 0, goal: 10 },
    { id: 4, name: "Магнат", description: "Заработай 1000000 тыкв", progress: 0, goal: 1000000 },
    { id: 5, name: "Элитный застройщик", description: "Построй 3 элитных здания", progress: 0, goal: 3 },
    { id: 6, name: "Модник", description: "Купи 5 предметов гардероба", progress: 0, goal: 5 },
    { id: 7, name: "Премиум игрок", description: "Купи премиум предмет", progress: 0, goal: 1 },
    { id: 8, name: "Максималист", description: "Улучши здание до 10 уровня", progress: 0, goal: 10 },
    { id: 9, name: "Halloween King", description: "Заработай 10000000 тыкв", progress: 0, goal: 10000000 },
    { id: 10, name: "Властелин города", description: "Построй все здания", progress: 0, goal: buildings.length }
];

let purchasedWardrobeItems = {
    colors: [],
    backgrounds: []
};

function getItemIcon(id) {
    const icons = {
        'paw': '🐾',
        'energy': '⚡',
        'puppy': '🐕',
        'bowl': '🍽️',
        'toy': '🧸',
        'bed': '🛏️',
        'house': '🏠',
        'park': '🌳',
        'golden_kennel': '🏆',
        'diamond_collar': '💎',
        'pet_castle': '🏰',
        'vip_spa': '💆',
        'helicopter': '🚁',
        'private_island': '🏝️'
    };
    return icons[id] || '❓';
}

function getItemDescription(id) {
    const descriptions = {
        'paw': 'Увеличивает силу клика',
        'energy': 'Дает временный бонус к производству',
        'puppy': 'Производит тыквы автоматически',
        'bowl': 'Увеличивает производство тыкв',
        'toy': 'Значительно увеличивает производство',
        'bed': 'Большое увеличение производства',
        'house': 'Огромное увеличение производства',
        'park': 'Максимальное увеличение производства',
        'golden_kennel': 'Премиум предмет: Золотая конура',
        'diamond_collar': 'Премиум предмет: Алмазный ошейник',
        'pet_castle': 'Премиум предмет: Замок для питомца',
        'vip_spa': 'Премиум предмет: VIP-спа',
        'helicopter': 'Премиум предмет: Вертолет',
        'private_island': 'Премиум предмет: Частный остров'
    };
    return descriptions[id] || 'Описание отсутствует';
}

function openShop() {
    const container = document.getElementById('shopContainer');
    container.style.display = 'block';
    container.style.position = 'fixed';
    container.style.top = '50%';
    container.style.left = '50%';
    container.style.transform = 'translate(-50%, -50%)';
    container.style.maxWidth = '90vw';
    container.style.width = '800px';
    container.style.maxHeight = '90vh';
    container.style.overflowY = 'auto';
    container.style.background = 'linear-gradient(135deg, #1a0f2e 0%, #2d1b36 100%)';
    container.style.border = '2px solid #ff6b1a';
    container.style.borderRadius = '15px';
    container.style.padding = '20px';
    container.style.zIndex = '1000';
    renderShop();
}

function calculateTotalIncome() {
    let totalIncome = 0;
    for (const buildingId in gameState.buildings) {
        const building = gameState.buildings[buildingId];
        if (building && building.income) {
            totalIncome += building.income;
        }
    }
    return totalIncome;
}

function generatePremiumItems() {
    const premiumItems = [
        {id: 'golden_kennel', name: 'Золотая конура', baseCost: 100000, income: 1000},
        {id: 'diamond_collar', name: 'Алмазный ошейник', baseCost: 500000, income: 5000},
        {id: 'pet_castle', name: 'Замок для питомца', baseCost: 1000000, income: 10000},
        {id: 'vip_spa', name: 'VIP-спа', baseCost: 5000000, income: 50000},
        {id: 'helicopter', name: 'Вертолет', baseCost: 10000000, income: 100000},
        {id: 'private_island', name: 'Частный остров', baseCost: 50000000, income: 500000}
    ];

    return premiumItems.map(item => `
        <div class="item">
            <div class="item-info">
                <div class="icon">${getItemIcon(item.id)}</div>
                <div>
                    <h3 class="title">${item.name}</h3>
                    <p class="details">Цена: <span class="price">${formatNumber(item.baseCost)} тыкв</span></p>
                </div>
            </div>
            <button class="menu-button" onclick="purchasePremiumItem('${item.id}')">Купить</button>
        </div>
    `).join('');
}

function closeShop() {
    document.getElementById('shopContainer').style.display = 'none';
}

function purchaseShopItem(itemId) { 
    const item = shopItems.find(i => i.id === itemId);
    const cost = Math.floor(item.baseCost * Math.pow(1.15, item.level));
    
    if (treats >= cost) {
        treats -= cost;
        item.level++;
        
        if (item.id === 'paw') {
            clickPower += item.income;    
        } else if (item.id === 'energy') {
            // Handle energy increase
        } else {
            perSecond += item.income;
        }
        
        showNotification(`${item.name} куплен!`);
        updateDisplay();
        renderShop();
    } else {
        showNotification('Недостаточно тыкв!');
    }
}

function showItemTooltip(event, itemId) {
    const tooltip = event.target.parentElement.querySelector('.tooltip');
    tooltip.style.display = tooltip.style.display === 'block' ? 'none' : 'block';
    
    document.addEventListener('click', function hideTooltip(e) {
        if (!e.target.classList.contains('question-mark')) {
            tooltip.style.display = 'none';
            document.removeEventListener('click', hideTooltip);
        }
    });
}

function generateRegularItems() {
    return shopItems.map(item => `
        <div class="item">
            <div class="item-info">
                <div class="icon">${getItemIcon(item.id)}</div>
                <div>
                    <h3 class="title">${item.name}</h3>
                    <p class="details">Цена: <span class="price">${Math.floor(item.baseCost * Math.pow(1.15, item.level))} тыкв</span><br>Уровень: ${item.level}</p>
                </div>
            </div>
            <div class="question-mark" onclick="showItemTooltip(event, '${item.id}')">?</div>
            <button class="menu-button" onclick="purchaseShopItem('${item.id}')">Купить</button>
            <div class="tooltip">${getItemDescription(item.id)}</div>
        </div>
    `).join('');
}

function showCategory(category) {
    const regularItems = document.getElementById('regularItems');
    const premiumItems = document.getElementById('premiumItems');
    const categoryButtons = document.querySelectorAll('.category-button');

    if (category === 'regular') {
        regularItems.style.display = 'block';
        premiumItems.style.display = 'none';
        categoryButtons[0].classList.add('active');
        categoryButtons[1].classList.remove('active');
    } else {
        regularItems.style.display = 'none';
        premiumItems.style.display = 'block';
        categoryButtons[0].classList.remove('active');
        categoryButtons[1].classList.add('active');
    }
}

let gameState = {
    money: 0,
    buildings: {},
    unclaimedIncome: 0
};

let shopItems = [
    {id: 'energy', name: 'Улучшение Энергии', baseCost: 500, level: 0, income: 500},
    {id: 'paw', name: 'Волшебная Лапа', baseCost: 10, level: 0, income: 1},
    {id: 'puppy', name: 'Щенок', baseCost: 15, level: 0, income: 0.1},
    {id: 'bowl', name: 'Миска', baseCost: 100, level: 0, income: 1},
    {id: 'toy', name: 'Пищащая игрушка', baseCost: 500, level: 0, income: 5},
    {id: 'bed', name: 'Лежанка', baseCost: 1000, level: 0, income: 10},
    {id: 'house', name: 'Домик', baseCost: 5000, level: 0, income: 50},
    {id: 'park', name: 'Парк', baseCost: 20000, level: 0, income: 200}
];

function clickDog() {
    treats += clickPower;
    clicks++;
    updateDisplay();
    createFloatingNumber(clickPower);
    updateQuestProgress();
}

function createFloatingNumber(amount) {
    const floating = document.createElement('div');
    floating.innerText = `+${amount} 🎃`;
    floating.style.position = 'absolute';
    floating.style.left = (event.clientX - 10) + 'px';
    floating.style.top = (event.clientY - 10) + 'px';
    floating.style.color = '#2ecc71'; // Change to green
    floating.style.fontSize = '20px';
    floating.style.pointerEvents = 'none';
    floating.style.animation = 'float 1s ease-out';
    document.body.appendChild(floating);
    setTimeout(() => floating.remove(), 1000);
}

function formatNumber(num) {
    if (num < 1000) return Math.floor(num);
    
    const units = ['', 'K', 'M', 'B', 'T', 'Q'];
    const order = Math.floor(Math.log(num) / Math.log(1000));
    
    let unitValue = num / Math.pow(1000, order);
    unitValue = Math.floor(unitValue * 100) / 100;
    
    return unitValue + units[order];
}

function updateDisplay() {
    const treatsElement = document.getElementById('treats');
    const perSecondElement = document.getElementById('perSecond');
    const levelElement = document.getElementById('level');
    const moneyElement = document.getElementById('money');

    if (treatsElement) treatsElement.textContent = formatNumber(treats);
    if (perSecondElement) perSecondElement.textContent = perSecond.toFixed(1);
    if (levelElement) levelElement.textContent = level;
    if (moneyElement) moneyElement.textContent = formatNumber(Math.floor(treats));
    
    if (document.documentElement) {
        document.documentElement.style.setProperty('--click-color', '#ff6b1a');
    }
}

function calculateOfflineProgress() {
    const lastSave = localStorage.getItem('lastSaveTime');
    if (lastSave) {
        const timeDiff = (Date.now() - parseInt(lastSave)) / 1000;
        const offlineIncome = Math.floor(timeDiff * perSecond);
        if (offlineIncome > 0) {
            gameState.unclaimedIncome += offlineIncome;
            showNotification(`Вы заработали ${formatNumber(offlineIncome)} тыкв пока были офлайн!`);
        }
    }
    localStorage.setItem('lastSaveTime', Date.now().toString());
}

function showNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    
    const container = document.getElementById('gameContainer').style.display === 'block' 
        ? document.getElementById('gameContainer')
        : document.body;
    
    container.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideDown 0.3s ease-out forwards';
        setTimeout(() => notification.remove(), 300);
    }, 2000);
}

function openAchievements() {
    const container = document.getElementById('gameContainer');
    container.style.display = 'block';
    container.innerHTML = `
        <button class="close-button" onclick="closeAchievements()">Закрыть</button>
        <div class="achievements-list">
            <h2>Награды</h2>
            ${generateAchievements()}
        </div>
    `;
}

function closeAchievements() {
    document.getElementById('gameContainer').style.display = 'none';
}

function generateAchievements() {
    const achievements = [
        { id: 1, name: "Первые шаги", description: "Заработать 100 тыкв", goal: 100, completed: false },
        { id: 2, name: "Тыквенный магнат", description: "Заработать 10000 тыкв", goal: 10000, completed: false },
        { id: 3, name: "Щелкунчик", description: "Кликнуть 1000 раз", goal: 1000, completed: false },
        { id: 4, name: "Коллекционер", description: "Собрать все предметы из магазина", goal: shopItems.length, completed: false },
        { id: 5, name: "Городской планировщик", description: "Построить 10 зданий", goal: 10, completed: false },
        { id: 6, name: "Премиум игрок", description: "Купить премиум предмет", goal: 1, completed: false },
        { id: 7, name: "Стилист", description: "Купить все предметы в гардеробе", goal: 10, completed: false },
        { id: 8, name: "Миллионер", description: "Заработать 1000000 тыкв", goal: 1000000, completed: false },
        { id: 9, name: "Мастер строитель", description: "Улучшить здание до максимального уровня", goal: 50, completed: false },
        { id: 10, name: "Легенда", description: "Выполнить все достижения", goal: 9, completed: false }
    ];

    return achievements.map(achievement => `
        <div class="achievement ${achievement.completed ? 'completed' : ''}">
            <h3>${achievement.name}</h3>
            <p>${achievement.description}</p>
            <div class="progress">
                <div class="progress-bar" style="width: ${achievement.completed ? '100' : '0'}%"></div>
            </div>
            <p>Прогресс: ${achievement.completed ? 'Выполнено!' : 'В процессе'}</p>
        </div>
    `).join('');
}

function openQuests() {
    const container = document.getElementById('gameContainer');
    container.style.display = 'block';
    container.innerHTML = `
        <button class="close-button" onclick="closeQuests()">Закрыть</button>
        <div class="quests-list">
            <h2>Задания</h2>
            ${generateQuests()}
        </div>
    `;
}

function closeQuests() {
    document.getElementById('gameContainer').style.display = 'none';
}

function generateQuests() {
    quests[0].progress = clicks;
    quests[1].progress = treats;
    quests[2].progress = Object.keys(gameState.buildings).length;
    quests[3].progress = treats;
    quests[4].progress = Object.values(gameState.buildings).filter(b => b.elite).length;
    quests[5].progress = Object.values(purchasedWardrobeItems).flat().length;
    quests[6].progress = purchasedPremiumItems.length;
    quests[7].progress = Math.max(...Object.values(gameState.buildings).map(b => b.level || 0));
    quests[8].progress = treats;
    quests[9].progress = Object.keys(gameState.buildings).length;
    
    return quests.map(quest => `
        <div class="quest">
            <h3>${quest.name}</h3>
            <p>${quest.description}</p>
            <div class="progress">
                <div class="progress-bar" style="width: ${(quest.progress / quest.goal * 100)}%"></div>
            </div>
            <p>Прогресс: ${Math.floor(quest.progress)}/${quest.goal}</p>
        </div>
    `).join('');
}

function updateQuestProgress() {
    quests[0].progress = clicks;
    quests[1].progress = treats;
    quests[2].progress = Object.keys(gameState.buildings).length;
    quests[3].progress = treats;
    quests[4].progress = Object.values(gameState.buildings).filter(b => b.elite).length;
    quests[5].progress = Object.values(purchasedWardrobeItems).flat().length;
    quests[6].progress = purchasedPremiumItems.length;
    quests[7].progress = Math.max(...Object.values(gameState.buildings).map(b => b.level || 0));
    quests[8].progress = treats;
    quests[9].progress = Object.keys(gameState.buildings).length;
    
    localStorage.setItem('questProgress', JSON.stringify(quests));
}

function openWardrobe() {
    const container = document.getElementById('wardrobeContainer');
    container.innerHTML = `
        <button class="close-button" onclick="closeWardrobe()">Закрыть</button>
        <div class="wardrobe-tabs">
            <button class="wardrobe-button active" onclick="showWardrobeTab('colors')">Цвет Мячика</button>
            <button class="wardrobe-button" onclick="showWardrobeTab('backgrounds')">Фоны</button>
        </div>
        <div class="wardrobe-items"></div>
    `;
    container.style.display = 'block';
    showWardrobeTab('colors');
}

function closeWardrobe() {
    document.getElementById('wardrobeContainer').style.display = 'none';
}

function showWardrobeTab(tab) {
    const wardrobeItems = document.querySelector('.wardrobe-items');
    const buttons = document.querySelectorAll('.wardrobe-tabs button');
    
    buttons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.toLowerCase().includes(tab)) {
            btn.classList.add('active');
        }
    });
    
    const items = {
        colors: [
            { id: 'orange', name: 'Оранжевый мячик', cost: 1000, color: '#ff6b1a' },
            { id: 'purple', name: 'Фиолетовый мячик', cost: 2000, color: '#9b59b6' },
            { id: 'green', name: 'Зелёный мячик', cost: 3000, color: '#2ecc71' },
            { id: 'blue', name: 'Синий мячик', cost: 4000, color: '#3498db' },
            { id: 'red', name: 'Красный мячик', cost: 5000, color: '#e74c3c' },
            { id: 'yellow', name: 'Жёлтый мячик', cost: 6000, color: '#f1c40f' },
            { id: 'pink', name: 'Розовый мячик', cost: 7000, color: '#e84393' },
            { id: 'cyan', name: 'Голубой мячик', cost: 8000, color: '#00cec9' }
        ],
        backgrounds: [
            { id: 'spooky', name: 'Жуткий фон', cost: 5000, pattern: 'linear-gradient(135deg, #1a0f2e 0%, #2d1b36 100%)' },
            { id: 'haunted', name: 'Призрачный фон', cost: 10000, pattern: 'linear-gradient(135deg, #2c3e50 0%, #3498db 100%)' },
            { id: 'dark', name: 'Тёмный фон', cost: 15000, pattern: 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)' },
            { id: 'mystic', name: 'Мистический фон', cost: 20000, pattern: 'linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%)' },
            { id: 'blood', name: 'Кровавый фон', cost: 25000, pattern: 'linear-gradient(135deg, #c0392b 0%, #e74c3c 100%)' }
        ]
    };
    
    wardrobeItems.innerHTML = items[tab].map(item => `
        <div class="wardrobe-item">
            <h3>${item.name}</h3>
            <div class="preview" style="background: ${item.color || item.pattern}"></div>
            ${purchasedWardrobeItems[tab].includes(item.id) ? 
                `<button onclick="purchaseWardrobeItem('${tab}', '${item.id}')" class="menu-button">Применить</button>` :
                `<p>Цена: ${formatNumber(item.cost)} тыкв</p>
                <button onclick="purchaseWardrobeItem('${tab}', '${item.id}')" class="menu-button">Купить</button>`
            }
        </div>
    `).join('');
}

function purchaseWardrobeItem(type, id) {
    const items = {
        colors: [
            { id: 'orange', cost: 1000, color: '#ff6b1a' },
            { id: 'purple', cost: 2000, color: '#9b59b6' },
            { id: 'green', cost: 3000, color: '#2ecc71' },
            { id: 'blue', cost: 4000, color: '#3498db' },
            { id: 'red', cost: 5000, color: '#e74c3c' }
        ],
        backgrounds: [
            { id: 'spooky', cost: 5000, pattern: 'linear-gradient(135deg, #1a0f2e 0%, #2d1b36 100%)' },
            { id: 'haunted', cost: 10000, pattern: 'linear-gradient(135deg, #2c3e50 0%, #3498db 100%)' },
            { id: 'dark', cost: 15000, pattern: 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)' },
            { id: 'mystic', cost: 20000, pattern: 'linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%)' },
            { id: 'blood', cost: 25000, pattern: 'linear-gradient(135deg, #c0392b 0%, #e74c3c 100%)' }
        ]
    };

    const item = items[type].find(i => i.id === id);
    const isPurchased = purchasedWardrobeItems[type].includes(id);
    
    if (isPurchased) {
        if (type === 'colors') {
            document.querySelector('.dog circle').setAttribute('fill', item.color);
        } else if (type === 'backgrounds') {
            document.body.style.background = item.pattern;
        }
        showNotification(`Применено: ${item.id}`);
    } else if (treats >= item.cost) {
        treats -= item.cost;
        purchasedWardrobeItems[type].push(id);
        if (type === 'colors') {
            document.querySelector('.dog circle').setAttribute('fill', item.color);
        } else if (type === 'backgrounds') {
            document.body.style.background = item.pattern;
        }
        showNotification(`Куплено: ${item.id}`);
        updateDisplay();
        showWardrobeTab(type);
    } else {
        showNotification('Недостаточно тыкв!');
    }
}

function renderShop() {
    const container = document.getElementById('shopContainer');
    container.innerHTML = `
        <button class="close-button" onclick="closeShop()">Закрыть</button>
        <div class="shop-categories">
            <button class="category-button active" onclick="showCategory('regular')">Обычные предметы</button>
            <button class="category-button" onclick="showCategory('premium')">Премиум предметы</button>
        </div>
        <div class="items-container">
            <div id="regularItems" class="category-section">
                ${generateRegularItems()}
            </div>
            <div id="premiumItems" class="category-section" style="display:none">
                ${generatePremiumItems()}
            </div>
        </div>
    `;
}

function loadGame() {
    const savedGame = localStorage.getItem('spookyPuppyGame');
    if (savedGame) {
        const gameData = JSON.parse(savedGame);
        treats = gameData.treats;
        perSecond = gameData.perSecond;
        level = gameData.level;
        gameState = gameData.gameState;
        shopItems = gameData.shopItems;
        purchasedWardrobeItems = gameData.purchasedWardrobeItems || { colors: [], backgrounds: [] };
        updateDisplay();
        closeShop(); // Ensure the shop doesn't open automatically
    }
}

function saveGame() {
    const gameData = {
        treats: treats,
        perSecond: perSecond,
        level: level,
        gameState: gameState,
        shopItems: shopItems,
        purchasedWardrobeItems: purchasedWardrobeItems
    };
    localStorage.setItem('spookyPuppyGame', JSON.stringify(gameData));
}

function purchasePremiumItem(itemId) {
    const premiumItems = {
        golden_kennel: {cost: 100000, income: 1000},
        diamond_collar: {cost: 500000, income: 5000},
        pet_castle: {cost: 1000000, income: 10000},
        vip_spa: {cost: 5000000, income: 50000},
        helicopter: {cost: 10000000, income: 100000},
        private_island: {cost: 50000000, income: 500000}
    };

    const item = premiumItems[itemId];
    if (treats >= item.cost) {
        treats -= item.cost;
        perSecond += item.income;
        showNotification(`Премиум предмет куплен!`);
        updateDisplay();
    } else {
        showNotification('Недостаточно тыкв!');
    }
}

function claimIncome() {
    if (gameState.unclaimedIncome > 0) {
        const fee = Math.floor(gameState.unclaimedIncome * 0.1); // 10% fee
        const amount = Math.floor(gameState.unclaimedIncome - fee);
        treats += amount;
        gameState.unclaimedIncome = 0; // Reset unclaimed balance
        showNotification(`Получено ${formatNumber(amount)} 🎃 (-${formatNumber(fee)} комиссия)`);
        updateDisplay();
        updateCityUI();
        saveGame();
    }
}

function openTown() {
    const container = document.getElementById('gameContainer');
    container.style.display = 'block';
    container.innerHTML = `
        <button class="close-button" onclick="closeTown()">Закрыть</button>
        <div class="resources">
            <div class="money">🎃 <span id="money">${formatNumber(Math.floor(treats))}</span></div>
            <div class="income">👻 <span id="income">${formatNumber(calculateTotalIncome())}</span>/10сек</div>
            <div class="unclaimed">💰 <span id="unclaimed">${formatNumber(Math.floor(gameState.unclaimedIncome))}</span></div>
            <button class="claim-button" onclick="claimIncome()">Получить (-10%)</button>
        </div>
        <div class="city" id="city">
            ${buildings.map(building => {
                const owned = gameState.buildings[building.id] || { level: 0, income: 0 };
                const cost = Math.floor(building.baseCost * Math.pow(building.multiplier, owned.level));
                const eliteClass = building.elite ? 'elite' : '';
                const spaceStationClass = building.id === 9 ? 'spacestation' : '';
                return `
                    <div class="building ${eliteClass} ${spaceStationClass}" onclick="upgradeBuilding(${building.id})">
                        ${building.elite ? '<span class="elite-tag">Elite</span>' : ''}
                        ${building.isNew ? '<span class="new-tag">New!</span>' : ''}
                        <div class="icon">${building.icon}</div>
                        <h3>${building.name}</h3>
                        <p>Уровень: ${owned.level}</p>
                        <p>Доход: ${formatNumber(owned.income)}/10сек</p>
                        <p>Цена: ${formatNumber(cost)} 🎃</p>
                    </div>
                `;
            }).join('')}
        </div>
    `;
    updateCityUI();
}

function closeTown() {
    document.getElementById('gameContainer').style.display = 'none';
}

function updateCityUI() {
    const gameContainer = document.getElementById('gameContainer');
    if (gameContainer && gameContainer.style.display === 'block') {
        const moneySpan = document.getElementById('money');
        const incomeSpan = document.getElementById('income');
        const unclaimedSpan = document.getElementById('unclaimed');
        
        if (moneySpan) moneySpan.textContent = formatNumber(Math.floor(treats));
        if (incomeSpan) incomeSpan.textContent = formatNumber(calculateTotalIncome());
        if (unclaimedSpan) unclaimedSpan.textContent = formatNumber(Math.floor(gameState.unclaimedIncome));
    }
    updateDisplay(); // Ensure display updates in real-time
}

// Modify the setInterval that handles income:
setInterval(() => {
    treats += perSecond; // Regular passive income
    gameState.unclaimedIncome += calculateTotalIncome() / 10; // Add city income to unclaimed balance
    updateDisplay();
    updateCityUI(); // Update city UI regularly
    saveGame();
}, 1000);

function upgradeBuilding(buildingId) {
    const building = buildings.find(b => b.id === buildingId);
    const ownedBuilding = gameState.buildings[buildingId] || { level: 0, income: 0 };
    const cost = Math.floor(building.baseCost * Math.pow(building.multiplier, ownedBuilding.level));
    
    if (treats >= cost) {
        treats -= cost;
        if (!gameState.buildings[buildingId]) {
            gameState.buildings[buildingId] = { level: 0, income: 0 };
        }
        gameState.buildings[buildingId].level++;
        gameState.buildings[buildingId].income = building.baseIncome * gameState.buildings[buildingId].level;
        
        showNotification(`Улучшено: ${building.name}`);
        updateCityUI();
        updateDisplay();
        saveGame();
    } else {
        showNotification('Недостаточно тыкв!');
    }
}

// Add auto-income calculation
setInterval(() => {
    treats += perSecond;
    updateDisplay();
}, 1000);

window.onload = () => {
    if (!document.getElementById('treats')) {
        console.error('Required elements not found. Page structure may be incomplete.');
        return;
    }
    loadGame();
    calculateOfflineProgress();
};
</script>
</body></html>
